<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CashFlow Pro - Budget & Wealth Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Fraunces:opsz,wght@9..144,600;9..144,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #faf8f5;
            --bg-card: #ffffff;
            --bg-accent: #f0ebe3;
            --text-primary: #1a1a1a;
            --text-secondary: #6b6b6b;
            --text-muted: #9a9a9a;
            --accent-green: #2d6a4f;
            --accent-green-light: #d8f3dc;
            --accent-red: #c44536;
            --accent-red-light: #fce4e1;
            --accent-blue: #3a86ff;
            --accent-orange: #f48c06;
            --accent-purple: #7b2cbf;
            --border: #e8e4de;
            --shadow: 0 2px 12px rgba(0,0,0,0.06);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.1);
            --radius: 16px;
            --radius-sm: 10px;
        }

        /* ==================== */
        /* ONBOARDING SLIDESHOW */
        /* ==================== */
        .onboarding {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            z-index: 10000;
        }

        .onboarding.hidden {
            display: none;
        }

        .slides-container {
            height: calc(100% - 100px);
            position: relative;
            overflow: hidden;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 24px;
            text-align: center;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s ease-out;
        }

        .slide.active {
            opacity: 1;
            transform: translateX(0);
        }

        .slide.exit {
            opacity: 0;
            transform: translateX(-100%);
        }

        .slide-icon {
            font-size: 72px;
            margin-bottom: 24px;
        }

        .slide-title {
            font-family: 'Fraunces', serif;
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .slide-title span {
            background: linear-gradient(135deg, #10b981, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .slide-text {
            font-size: 16px;
            color: #94a3b8;
            line-height: 1.6;
            max-width: 300px;
            margin-bottom: 24px;
        }

        .slide-features {
            text-align: left;
            width: 100%;
            max-width: 280px;
        }

        .slide-feature {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            margin-bottom: 10px;
            color: #e2e8f0;
            font-size: 14px;
        }

        .name-input {
            width: 100%;
            max-width: 280px;
            padding: 16px 20px;
            font-size: 18px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: #ffffff;
            text-align: center;
            outline: none;
        }

        .name-input:focus {
            border-color: #10b981;
        }

        .name-input::placeholder {
            color: #64748b;
        }

        .nav-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 24px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dots {
            display: flex;
            gap: 8px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .dot.active {
            width: 24px;
            border-radius: 4px;
            background: #10b981;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
        }

        .btn-skip {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #64748b;
            font-size: 14px;
            cursor: pointer;
        }

        .btn-next {
            padding: 14px 28px;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-next.finish {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        /* ==================== */
        /* FINANCIAL HEALTH     */
        /* ==================== */
        .health-header {
            padding: 24px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        .health-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .health-header-left h1 {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .health-header-left p {
            font-size: 13px;
            color: var(--text-muted);
        }

        .health-score-container {
            display: flex;
            justify-content: center;
            padding: 20px 0;
        }

        .health-score-circle {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .health-score-svg {
            transform: rotate(-90deg);
            width: 200px;
            height: 200px;
        }

        .health-score-bg {
            fill: none;
            stroke: var(--bg-accent);
            stroke-width: 12;
        }

        .health-score-progress {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease, stroke 0.5s ease;
        }

        .health-score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .health-score-value {
            font-family: 'Fraunces', serif;
            font-size: 56px;
            font-weight: 700;
            line-height: 1;
        }

        .health-score-label {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .health-score-status {
            text-align: center;
            padding: 16px;
            margin: 0 20px 20px;
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .health-score-status-text {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .health-score-status-desc {
            font-size: 13px;
            color: var(--text-muted);
        }

        .health-content {
            padding: 0 20px 120px;
        }

        .health-section {
            margin-bottom: 24px;
        }

        .health-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .health-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .health-metric-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
        }

        .health-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .health-metric-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .health-metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .health-metric-icon.good { background: rgba(16, 185, 129, 0.15); }
        .health-metric-icon.warning { background: rgba(245, 158, 11, 0.15); }
        .health-metric-icon.bad { background: rgba(239, 68, 68, 0.15); }

        .health-metric-name {
            font-weight: 600;
            font-size: 14px;
        }

        .health-metric-value {
            font-family: 'Fraunces', serif;
            font-size: 20px;
            font-weight: 700;
        }

        .health-metric-value.good { color: #10b981; }
        .health-metric-value.warning { color: #f59e0b; }
        .health-metric-value.bad { color: #ef4444; }

        .health-metric-bar {
            height: 8px;
            background: var(--bg-accent);
            border-radius: 4px;
            overflow: hidden;
        }

        .health-metric-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .health-metric-bar-fill.good { background: linear-gradient(90deg, #10b981, #34d399); }
        .health-metric-bar-fill.warning { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .health-metric-bar-fill.bad { background: linear-gradient(90deg, #ef4444, #f87171); }

        .health-metric-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .health-tips {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .health-tip {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 14px 16px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .health-tip-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .health-tip-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .health-tip-text strong {
            color: var(--text-primary);
        }

        /* Theme: Ocean */
        .theme-ocean {
            --bg-primary: #f0f7fa;
            --bg-card: #ffffff;
            --bg-accent: #d6eaf5;
            --text-primary: #1a3a4a;
            --text-secondary: #4a7a9a;
            --text-muted: #7aaaca;
            --accent-green: #0077b6;
            --accent-green-light: #caf0f8;
            --border: #c0dae8;
        }

        /* Theme: Sunset */
        .theme-sunset {
            --bg-primary: #fdf6f0;
            --bg-card: #ffffff;
            --bg-accent: #fce8d8;
            --text-primary: #3d2314;
            --text-secondary: #8a5a4a;
            --text-muted: #b88a7a;
            --accent-green: #e07a5f;
            --accent-green-light: #fce8d8;
            --border: #f0d4c4;
        }

        /* Theme: Lavender */
        .theme-lavender {
            --bg-primary: #f8f5fc;
            --bg-card: #ffffff;
            --bg-accent: #ebe0f5;
            --text-primary: #2d1f3d;
            --text-secondary: #6a5a8a;
            --text-muted: #9a8aba;
            --accent-green: #7c3aed;
            --accent-green-light: #ede9fe;
            --border: #ddd0ea;
        }

        /* Theme: Rose */
        .theme-rose {
            --bg-primary: #fdf2f4;
            --bg-card: #ffffff;
            --bg-accent: #fce4e8;
            --text-primary: #3d1a24;
            --text-secondary: #8a4a5a;
            --text-muted: #ba7a8a;
            --accent-green: #e11d48;
            --accent-green-light: #ffe4e6;
            --border: #f0c4ca;
        }

        /* Theme: Forest */
        .theme-forest {
            --bg-primary: #f0f5f0;
            --bg-card: #ffffff;
            --bg-accent: #d8e8d8;
            --text-primary: #1a2e1a;
            --text-secondary: #4a6a4a;
            --text-muted: #7a9a7a;
            --accent-green: #166534;
            --accent-green-light: #dcfce7;
            --border: #c0d8c0;
        }

        /* Theme: Dark Mode */
        .theme-dark {
            --bg-primary: #111827;
            --bg-card: #1f2937;
            --bg-accent: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --accent-green: #10b981;
            --accent-green-light: rgba(16, 185, 129, 0.15);
            --accent-red: #f87171;
            --accent-red-light: rgba(248, 113, 113, 0.15);
            --border: #374151;
        }

        /* Financial Health Score Page */
        .health-header {
            padding: 24px 20px;
            background: var(--bg-card);
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .health-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .health-header h1 {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
        }

        .health-score-circle {
            width: 180px;
            height: 180px;
            margin: 0 auto 16px;
            position: relative;
        }

        .health-score-ring {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                var(--score-color, #10b981) calc(var(--score, 0) * 3.6deg),
                var(--bg-accent) 0deg
            );
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .health-score-ring::before {
            content: '';
            position: absolute;
            width: 140px;
            height: 140px;
            background: var(--bg-card);
            border-radius: 50%;
        }

        .health-score-value {
            position: relative;
            z-index: 1;
            font-family: 'Fraunces', serif;
            font-size: 48px;
            font-weight: 700;
            color: var(--score-color, #10b981);
        }

        .health-score-label {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .health-score-status {
            font-size: 18px;
            font-weight: 600;
            color: var(--score-color, #10b981);
        }

        .health-content {
            padding: 20px;
            padding-bottom: 120px;
        }

        .health-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .health-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .health-metric {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
        }

        .health-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .health-metric-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .health-metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .health-metric-icon.green { background: var(--accent-green-light); }
        .health-metric-icon.red { background: var(--accent-red-light); }
        .health-metric-icon.blue { background: rgba(59, 130, 246, 0.15); }
        .health-metric-icon.purple { background: rgba(139, 92, 246, 0.15); }
        .health-metric-icon.orange { background: rgba(249, 115, 22, 0.15); }

        .health-metric-name {
            font-weight: 600;
            font-size: 14px;
        }

        .health-metric-value {
            font-family: 'Fraunces', serif;
            font-size: 18px;
            font-weight: 700;
        }

        .health-metric-value.good { color: #10b981; }
        .health-metric-value.warning { color: #f59e0b; }
        .health-metric-value.bad { color: #ef4444; }

        .health-metric-bar {
            height: 8px;
            background: var(--bg-accent);
            border-radius: 4px;
            overflow: hidden;
        }

        .health-metric-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .health-metric-bar-fill.good { background: linear-gradient(90deg, #10b981, #34d399); }
        .health-metric-bar-fill.warning { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .health-metric-bar-fill.bad { background: linear-gradient(90deg, #ef4444, #f87171); }

        .health-tips {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .health-tip {
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            padding: 14px 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            box-shadow: var(--shadow);
        }

        .health-tip-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .health-tip-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .health-tip-text strong {
            color: var(--text-primary);
        }
            --bg-accent: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --accent-green: #10b981;
            --accent-green-light: #064e3b;
            --accent-red: #f87171;
            --accent-red-light: #7f1d1d;
            --accent-blue: #60a5fa;
            --accent-orange: #fbbf24;
            --accent-purple: #a78bfa;
            --border: #374151;
            --shadow: 0 2px 12px rgba(0,0,0,0.3);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.4);
        }

        .theme-dark .header {
            background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-primary) 100%);
        }

        .theme-dark .balance-card {
            background: linear-gradient(135deg, #065f46 0%, #064e3b 100%);
        }

        .theme-dark .debt-header,
        .theme-dark .wealth-header,
        .theme-dark .empire-header {
            background: var(--bg-card);
        }

        .theme-dark .wealth-summary-card.saved {
            background: linear-gradient(135deg, #065f46 0%, #064e3b 100%);
        }

        .theme-dark .wealth-summary-card.target {
            background: linear-gradient(135deg, #5b21b6 0%, #4c1d95 100%);
        }

        .theme-dark .modal {
            background: var(--bg-card);
        }

        .theme-dark .input-field {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .theme-dark .input-field:focus {
            border-color: var(--accent-green);
        }

        .theme-dark .transaction-item,
        .theme-dark .debt-card,
        .theme-dark .goal-card {
            background: var(--bg-card);
        }

        .theme-dark .transaction-icon.food { background: rgba(255,243,224,0.15); }
        .theme-dark .transaction-icon.transport { background: rgba(227,242,253,0.15); }
        .theme-dark .transaction-icon.shopping { background: rgba(252,228,236,0.15); }
        .theme-dark .transaction-icon.bills { background: rgba(243,229,245,0.15); }
        .theme-dark .transaction-icon.income { background: rgba(16,185,129,0.2); }
        .theme-dark .transaction-icon.entertainment { background: rgba(255,248,225,0.15); }
        .theme-dark .transaction-icon.health { background: rgba(232,245,233,0.15); }
        .theme-dark .transaction-icon.other { background: var(--bg-accent); }

        .theme-dark .bottom-nav {
            background: var(--bg-card);
            border-top-color: var(--border);
        }

        .theme-dark .toast {
            background: var(--text-primary);
            color: var(--bg-primary);
        }

        /* Dark mode toggle styles */
        .dark-mode-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            margin-bottom: 16px;
        }

        .dark-mode-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .dark-mode-icon {
            font-size: 20px;
        }

        /* Global Header with Dark Mode Toggle */
        .global-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-greeting {
            font-size: 13px;
            color: var(--text-muted);
        }

        .user-name {
            font-family: 'Fraunces', serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dark-mode-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--bg-accent);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .settings-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--bg-accent);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .settings-btn:active {
            transform: scale(0.9);
        }

        .header-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .dark-mode-btn:active {
            transform: scale(0.95);
        }

        /* Categories Section on Main Page */
        .categories-overview {
            padding: 0 20px;
            margin-bottom: 20px;
        }

        .categories-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 4px 0;
            -webkit-overflow-scrolling: touch;
        }

        .categories-scroll::-webkit-scrollbar {
            display: none;
        }

        .category-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            min-width: 70px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .category-chip:active {
            transform: scale(0.95);
        }

        .category-chip.selected {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
        }

        .category-chip-icon {
            font-size: 24px;
        }

        .category-chip-name {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .category-chip-amount {
            font-size: 11px;
            font-weight: 700;
            color: var(--accent-red);
        }

        /* Simplified Balance Display */
        .balance-overview {
            padding: 20px;
            text-align: center;
        }

        .balance-main {
            margin-bottom: 20px;
        }

        .balance-main-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .balance-main-value {
            font-family: 'Fraunces', serif;
            font-size: 40px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .balance-row {
            display: flex;
            justify-content: center;
            gap: 32px;
        }

        .balance-item {
            text-align: center;
        }

        .balance-item-value {
            font-size: 18px;
            font-weight: 700;
        }

        .balance-item-value.income {
            color: var(--accent-green);
        }

        .balance-item-value.expense {
            color: var(--accent-red);
        }

        .balance-item-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Quick Add Buttons */
        .quick-add-row {
            display: flex;
            gap: 10px;
            padding: 0 20px;
            margin-bottom: 20px;
        }

        .quick-add-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px;
            border-radius: var(--radius-sm);
            border: none;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-add-btn.income {
            background: var(--accent-green);
            color: white;
        }

        .quick-add-btn.expense {
            background: var(--accent-red);
            color: white;
        }

        .quick-add-btn:active {
            transform: scale(0.97);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
        }

        .app {
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            position: relative;
            background: var(--bg-primary);
        }

        /* Header */
        .header {
            padding: 20px 20px 0;
            background: linear-gradient(180deg, #fff 0%, var(--bg-primary) 100%);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .logo {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-green);
            letter-spacing: -0.5px;
        }

        .date-display {
            font-size: 13px;
            color: var(--text-secondary);
            background: var(--bg-card);
            padding: 8px 14px;
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        /* Balance Card */
        .balance-card {
            background: var(--accent-green);
            border-radius: var(--radius);
            padding: 28px 24px;
            margin: 0 20px 20px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
        }

        .balance-card::after {
            content: '';
            position: absolute;
            bottom: -40%;
            left: -20%;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
        }

        .balance-label {
            font-size: 13px;
            opacity: 0.85;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-amount {
            font-family: 'Fraunces', serif;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }

        .balance-stats {
            display: flex;
            gap: 24px;
            position: relative;
            z-index: 1;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .stat-icon.income {
            background: rgba(255,255,255,0.2);
        }

        .stat-icon.expense {
            background: rgba(255,255,255,0.2);
        }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.75;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            padding: 0 20px;
            margin-bottom: 24px;
        }

        .action-btn {
            flex: 1;
            padding: 14px;
            border-radius: var(--radius-sm);
            border: none;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .action-btn.income {
            background: var(--accent-green-light);
            color: var(--accent-green);
        }

        .action-btn.expense {
            background: var(--accent-red-light);
            color: var(--accent-red);
        }

        .action-btn:active {
            transform: scale(0.97);
        }

        /* Chart Section */
        .chart-section {
            background: var(--bg-card);
            margin: 0 20px 20px;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
        }

        .period-selector {
            display: flex;
            gap: 4px;
            background: var(--bg-accent);
            padding: 4px;
            border-radius: 8px;
        }

        .period-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            font-family: 'DM Sans', sans-serif;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .period-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chart-container {
            height: 160px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 8px;
            padding: 10px 0;
        }

        .chart-bar-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .chart-bar {
            width: 100%;
            max-width: 32px;
            border-radius: 6px 6px 4px 4px;
            background: var(--bg-accent);
            position: relative;
            min-height: 8px;
            transition: all 0.3s ease;
        }

        .chart-bar.has-expense::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--accent-red);
            opacity: 0.7;
            border-radius: 0 0 4px 4px;
        }

        .chart-bar.active {
            background: var(--accent-green);
        }

        .chart-label {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Categories */
        .categories-section {
            padding: 0 20px;
            margin-bottom: 20px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 14px;
        }

        .category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 14px 8px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .category-item:active {
            transform: scale(0.95);
            background: var(--bg-accent);
        }

        .category-item.selected {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
        }

        .category-icon {
            font-size: 22px;
        }

        .category-name {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            text-align: center;
        }

        /* Transactions */
        .transactions-section {
            flex: 1;
            background: var(--bg-card);
            border-radius: var(--radius) var(--radius) 0 0;
            padding: 20px 20px 100px;
            margin-top: 10px;
        }

        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .transaction-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .transaction-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .transaction-icon.food { background: #fff3e0; }
        .transaction-icon.transport { background: #e3f2fd; }
        .transaction-icon.shopping { background: #fce4ec; }
        .transaction-icon.bills { background: #f3e5f5; }
        .transaction-icon.income { background: var(--accent-green-light); }
        .transaction-icon.entertainment { background: #fff8e1; }
        .transaction-icon.health { background: #e8f5e9; }
        .transaction-icon.other { background: var(--bg-accent); }

        .transaction-details {
            flex: 1;
            min-width: 0;
        }

        .transaction-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transaction-category {
            font-size: 12px;
            color: var(--text-muted);
        }

        .transaction-amount {
            font-size: 15px;
            font-weight: 600;
            text-align: right;
        }

        .transaction-amount.expense {
            color: var(--accent-red);
        }

        .transaction-amount.income {
            color: var(--accent-green);
        }

        .transaction-time {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .transaction-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .transaction-actions {
            display: flex;
            gap: 6px;
        }

        .transaction-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--bg-accent);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .transaction-action-btn:active {
            transform: scale(0.9);
        }

        .transaction-action-btn.edit {
            color: var(--text-secondary);
        }

        .transaction-action-btn.delete {
            color: var(--accent-red);
        }

        .transaction-action-btn.delete:active {
            background: var(--accent-red-light);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: var(--bg-card);
            width: 100%;
            max-width: 430px;
            border-radius: var(--radius) var(--radius) 0 0;
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-handle {
            width: 40px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin: 0 auto 20px;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .modal-header .modal-title {
            margin-bottom: 0;
            flex: 1;
        }

        .modal-close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--bg-accent);
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close-btn:active {
            transform: scale(0.95);
            background: var(--border);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-cancel-btn {
            flex: 1;
            padding: 14px;
            border: 2px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-cancel-btn:active {
            background: var(--bg-accent);
        }

        .modal-save-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
        }

        .modal-save-btn.expense {
            background: var(--accent-red);
        }

        .modal-save-btn.income {
            background: var(--accent-green);
        }

        .modal-save-btn:active {
            transform: scale(0.98);
        }

        .modal-title {
            font-family: 'Fraunces', serif;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 24px;
            text-align: center;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-field {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            transition: border-color 0.2s ease;
            background: var(--bg-primary);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .amount-input-wrapper {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .amount-input {
            padding-left: 36px;
            font-size: 24px;
            font-weight: 600;
        }

        .modal-categories {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .submit-btn.income {
            background: var(--accent-green);
            color: white;
        }

        .submit-btn.expense {
            background: var(--accent-red);
            color: white;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        /* Settings Modal */
        .settings-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .settings-btn:active {
            background: var(--bg-accent);
        }

        .budget-input-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .budget-input-row .input-field {
            flex: 1;
        }

        .reset-btn {
            padding: 14px 20px;
            background: var(--accent-red-light);
            color: var(--accent-red);
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text-primary);
            color: white;
            padding: 14px 24px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 200;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Swipe to delete */
        .transaction-item {
            position: relative;
            overflow: hidden;
        }

        .delete-hint {
            font-size: 11px;
            color: var(--text-muted);
            text-align: center;
            margin-top: 16px;
        }

        /* Budget Progress Bar */
        .budget-progress {
            margin: 0 20px 20px;
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 16px 20px;
            box-shadow: var(--shadow);
        }

        .budget-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .budget-progress-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .budget-progress-amount {
            font-size: 13px;
            font-weight: 600;
        }

        .progress-bar {
            height: 10px;
            background: var(--bg-accent);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-green);
            border-radius: 5px;
            transition: width 0.5s ease, background 0.3s ease;
        }

        .progress-fill.warning {
            background: var(--accent-orange);
        }

        .progress-fill.danger {
            background: var(--accent-red);
        }

        /* Insights Section */
        .insights-section {
            margin: 0 20px 20px;
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 14px;
        }

        .insight-card {
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            padding: 14px;
            text-align: center;
        }

        .insight-value {
            font-family: 'Fraunces', serif;
            font-size: 22px;
            font-weight: 700;
            color: var(--accent-green);
            margin-bottom: 4px;
        }

        .insight-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Theme Picker */
        .theme-picker {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .theme-option {
            aspect-ratio: 1;
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .theme-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 50%;
        }

        .theme-option::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .theme-option.active {
            border-color: var(--accent-green);
            transform: scale(1.05);
        }

        .theme-option.th-sage::before { background: #2d6a4f; }
        .theme-option.th-sage::after { background: #faf8f5; }
        .theme-option.th-ocean::before { background: #0077b6; }
        .theme-option.th-ocean::after { background: #f0f7fa; }
        .theme-option.th-sunset::before { background: #e07a5f; }
        .theme-option.th-sunset::after { background: #fdf6f0; }
        .theme-option.th-lavender::before { background: #7c3aed; }
        .theme-option.th-lavender::after { background: #f8f5fc; }
        .theme-option.th-midnight::before { background: #22d3ee; }
        .theme-option.th-midnight::after { background: #0f172a; }
        .theme-option.th-rose::before { background: #e11d48; }
        .theme-option.th-rose::after { background: #fdf2f4; }
        .theme-option.th-forest::before { background: #166534; }
        .theme-option.th-forest::after { background: #f0f5f0; }

        /* Currency Selector */
        .currency-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .currency-option {
            padding: 12px 8px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 600;
        }

        .currency-option.active {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
        }

        /* Custom Category Modal */
        .custom-category-input {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .emoji-picker-btn {
            width: 52px;
            height: 52px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 6px;
            margin-bottom: 16px;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
        }

        .emoji-option {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .emoji-option:hover {
            background: var(--bg-accent);
        }

        /* Export Button */
        .export-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px;
            background: var(--bg-accent);
            color: var(--text-primary);
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 12px;
        }

        /* Tab Navigation for Settings */
        .settings-tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-accent);
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .settings-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .settings-tab.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .setting-section {
            margin-bottom: 24px;
        }

        .setting-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Recurring Transaction Badge */
        .recurring-badge {
            font-size: 10px;
            background: var(--accent-blue);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
        }

        .recurring-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            margin-bottom: 16px;
        }

        .toggle-switch {
            width: 50px;
            height: 28px;
            background: var(--border);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--accent-green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(22px);
        }

        .frequency-selector {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .frequency-selector.show {
            display: grid;
        }

        .frequency-option {
            padding: 10px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .frequency-option.active {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
        }

        /* Search & Filter */
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            background: var(--bg-card);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .filter-btn {
            padding: 12px 16px;
            background: var(--bg-accent);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 16px;
            cursor: pointer;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
            z-index: 50;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 20px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s ease;
        }

        .nav-item.active {
            color: var(--accent-green);
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
        }

        /* Page Container */
        .page {
            display: none;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        /* Debt Crusher Styles */
        .debt-header {
            padding: 24px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        .debt-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .debt-header-left h1 {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .debt-header-left p {
            font-size: 13px;
            color: var(--text-muted);
        }

        .debt-free-badge {
            background: var(--accent-green-light);
            color: var(--accent-green);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .debt-summary-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .debt-summary-card {
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            padding: 16px;
        }

        .debt-summary-card.total {
            background: linear-gradient(135deg, var(--accent-green) 0%, #1e5631 100%);
            color: white;
        }

        .debt-summary-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
            margin-bottom: 6px;
        }

        .debt-summary-value {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
        }

        .debt-summary-card:not(.total) .debt-summary-value {
            color: var(--accent-green);
        }

        /* Empty State - Start Here */
        .debt-empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 40px;
            text-align: center;
        }

        .debt-empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .debt-empty-title {
            font-family: 'Fraunces', serif;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .debt-empty-text {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .start-here-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px 32px;
            background: var(--accent-green);
            color: white;
            border: none;
            border-radius: 30px;
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(45, 106, 79, 0.3);
            transition: all 0.3s ease;
        }

        .start-here-btn:hover {
            transform: scale(1.05);
        }

        .start-here-btn:active {
            transform: scale(0.98);
        }

        /* Debt List */
        .debt-content {
            flex: 1;
            padding: 20px;
            padding-bottom: 100px;
            overflow-y: auto;
        }

        .debt-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .debt-section-title {
            font-size: 16px;
            font-weight: 600;
        }

        .add-debt-text-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--accent-green-light);
            color: var(--accent-green);
            border: none;
            border-radius: 20px;
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-debt-text-btn:active {
            transform: scale(0.95);
        }

        .debt-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent-green);
        }

        .debt-card.paid-off {
            border-left-color: #22c55e;
            opacity: 0.7;
        }

        .debt-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .debt-card-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .debt-card-icon {
            width: 44px;
            height: 44px;
            background: var(--bg-accent);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .debt-card-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 2px;
        }

        .debt-card-type {
            font-size: 12px;
            color: var(--text-muted);
        }

        .debt-card-balance {
            text-align: right;
        }

        .debt-card-balance-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .debt-card-balance-value {
            font-family: 'Fraunces', serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .debt-card-progress {
            margin-bottom: 12px;
        }

        .debt-progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .debt-progress-paid {
            color: var(--accent-green);
            font-weight: 600;
        }

        .debt-progress-percent {
            color: var(--text-muted);
        }

        .debt-progress-track {
            height: 8px;
            background: var(--bg-accent);
            border-radius: 4px;
            overflow: hidden;
        }

        .debt-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green) 0%, #4ade80 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .debt-card-footer {
            display: flex;
            gap: 8px;
        }

        .debt-action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .debt-action-btn.primary {
            background: var(--accent-green);
            color: white;
        }

        .debt-action-btn.secondary {
            background: var(--bg-accent);
            color: var(--text-secondary);
        }

        .debt-action-btn:active {
            transform: scale(0.97);
        }

        /* Auto-pay badge */
        .auto-pay-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            background: var(--accent-blue);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }

        /* Strategy Pills */
        .strategy-pills {
            display: flex;
            gap: 8px;
            padding: 0 20px;
            margin-bottom: 16px;
            overflow-x: auto;
        }

        .strategy-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 25px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .strategy-pill.active {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
            color: var(--accent-green);
        }

        .strategy-pill-icon {
            font-size: 16px;
        }

        /* Quick Stats Bar */
        .quick-stats-bar {
            display: flex;
            gap: 16px;
            padding: 12px 20px;
            background: var(--bg-accent);
            margin-bottom: 16px;
            overflow-x: auto;
        }

        .quick-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .quick-stat-icon {
            font-size: 18px;
        }

        .quick-stat-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .quick-stat-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Celebration Modal */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }

        .celebration-overlay.active {
            display: flex;
        }

        .celebration-content {
            text-align: center;
            color: white;
            padding: 40px;
        }

        .celebration-emoji {
            font-size: 80px;
            animation: celebrate 0.5s ease infinite alternate;
        }

        @keyframes celebrate {
            from { transform: scale(1) rotate(-5deg); }
            to { transform: scale(1.1) rotate(5deg); }
        }

        .celebration-title {
            font-family: 'Fraunces', serif;
            font-size: 28px;
            margin: 20px 0 10px;
        }

        .celebration-text {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 24px;
        }

        .celebration-btn {
            padding: 14px 32px;
            background: white;
            color: var(--accent-green);
            border: none;
            border-radius: 25px;
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b9d;
            animation: confetti-fall 3s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Auto-pay Schedule Selector */
        .schedule-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .schedule-option {
            padding: 14px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .schedule-option.active {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
        }

        .schedule-option-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .schedule-option-desc {
            font-size: 11px;
            color: var(--text-muted);
        }

        .custom-schedule-row {
            display: none;
            gap: 10px;
            margin-bottom: 16px;
        }

        .custom-schedule-row.show {
            display: flex;
        }

        .custom-schedule-row input {
            flex: 1;
        }

        .custom-schedule-row select {
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            background: var(--bg-primary);
        }

        /* Debt Type Selector Improved */
        .debt-type-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .debt-type-item {
            padding: 16px 10px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .debt-type-item.active {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
        }

        .debt-type-item-icon {
            font-size: 28px;
            margin-bottom: 6px;
        }

        .debt-type-item-label {
            font-size: 12px;
            font-weight: 600;
        }

        /* Next payment info */
        .next-payment-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--accent-blue);
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border-radius: var(--radius-sm);
            margin-top: 8px;
            font-size: 12px;
        }

        .next-payment-info-icon {
            font-size: 16px;
        }

        /* Wealth Builder Styles */
        .wealth-header {
            padding: 24px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        .wealth-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .wealth-header-left h1 {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .wealth-header-left p {
            font-size: 13px;
            color: var(--text-muted);
        }

        .wealth-summary-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .wealth-summary-card {
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            padding: 16px;
        }

        .wealth-summary-card.saved {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
        }

        .wealth-summary-card.target {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
        }

        .wealth-summary-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.85;
            margin-bottom: 6px;
        }

        .wealth-summary-value {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
        }

        /* Goals Empty State */
        .goals-empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 40px;
            text-align: center;
        }

        .goals-empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .goals-empty-title {
            font-family: 'Fraunces', serif;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .goals-empty-text {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .start-saving-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px 32px;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.3);
            transition: all 0.3s ease;
        }

        .start-saving-btn:hover {
            transform: scale(1.05);
        }

        /* Goals Content */
        .goals-content {
            flex: 1;
            padding: 20px;
            padding-bottom: 100px;
            overflow-y: auto;
        }

        .goals-quick-stats {
            display: flex;
            gap: 16px;
            padding: 12px 20px;
            background: var(--bg-accent);
            margin-bottom: 16px;
            overflow-x: auto;
        }

        .goals-quick-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .goals-quick-stat-icon {
            font-size: 18px;
        }

        .goals-quick-stat-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .goals-quick-stat-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Goal Cards */
        .goal-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
            border-left: 4px solid #059669;
        }

        .goal-card.completed {
            border-left-color: #fbbf24;
            background: linear-gradient(90deg, rgba(251,191,36,0.08) 0%, var(--bg-card) 100%);
        }

        .goal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .goal-card-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .goal-card-icon {
            width: 44px;
            height: 44px;
            background: var(--bg-accent);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .goal-card-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 2px;
        }

        .goal-card-due {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .goal-card-amounts {
            text-align: right;
        }

        .goal-card-saved {
            font-family: 'Fraunces', serif;
            font-size: 20px;
            font-weight: 700;
            color: #059669;
        }

        .goal-card-target {
            font-size: 12px;
            color: var(--text-muted);
        }

        .goal-card-progress {
            margin-bottom: 12px;
        }

        .goal-progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .goal-progress-remaining {
            color: var(--text-muted);
        }

        .goal-progress-percent {
            color: #059669;
            font-weight: 600;
        }

        .goal-progress-track {
            height: 10px;
            background: var(--bg-accent);
            border-radius: 5px;
            overflow: hidden;
        }

        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #059669 0%, #34d399 100%);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .goal-card.completed .goal-progress-bar {
            background: linear-gradient(90deg, #fbbf24 0%, #fcd34d 100%);
        }

        .goal-card-footer {
            display: flex;
            gap: 8px;
        }

        .goal-action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .goal-action-btn.primary {
            background: #059669;
            color: white;
        }

        .goal-action-btn.secondary {
            background: var(--bg-accent);
            color: var(--text-secondary);
        }

        .goal-action-btn:active {
            transform: scale(0.97);
        }

        /* Auto-save badge */
        .auto-save-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            background: #7c3aed;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }

        /* Next deposit info */
        .next-deposit-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
            border-radius: var(--radius-sm);
            margin-top: 8px;
            font-size: 12px;
        }

        /* Goal Type Grid */
        .goal-type-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .goal-type-item {
            padding: 16px 10px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .goal-type-item.active {
            border-color: #059669;
            background: rgba(5, 150, 105, 0.1);
        }

        .goal-type-item-icon {
            font-size: 28px;
            margin-bottom: 6px;
        }

        .goal-type-item-label {
            font-size: 12px;
            font-weight: 600;
        }

        /* Celebration for goals */
        .goal-celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }

        .goal-celebration-overlay.active {
            display: flex;
        }

        .goal-celebration-content {
            text-align: center;
            color: white;
            padding: 40px;
        }

        .goal-celebration-emoji {
            font-size: 80px;
            animation: celebrate 0.5s ease infinite alternate;
        }

        .goal-celebration-title {
            font-family: 'Fraunces', serif;
            font-size: 28px;
            margin: 20px 0 10px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .goal-celebration-text {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 24px;
        }

        /* Empire (Net Worth) Styles */
        .empire-header {
            padding: 24px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        .empire-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .empire-header-left h1 {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .empire-header-left p {
            font-size: 13px;
            color: var(--text-muted);
        }

        .net-worth-display {
            text-align: center;
            padding: 24px 20px;
            background: var(--bg-primary);
            margin: 0 20px;
            border-radius: var(--radius);
        }

        .net-worth-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .net-worth-value {
            font-family: 'Fraunces', serif;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .net-worth-value.positive {
            color: #10b981;
        }

        .net-worth-value.negative {
            color: #ef4444;
        }

        .net-worth-bar {
            height: 12px;
            background: var(--bg-accent);
            border-radius: 6px;
            overflow: hidden;
            display: flex;
        }

        .net-worth-bar-assets {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            transition: width 0.5s ease;
        }

        .net-worth-bar-liabilities {
            height: 100%;
            background: linear-gradient(90deg, #f87171 0%, #ef4444 100%);
            transition: width 0.5s ease;
        }

        .net-worth-bar-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
        }

        .net-worth-bar-labels .assets-label {
            color: #10b981;
            font-weight: 600;
        }

        .net-worth-bar-labels .liabilities-label {
            color: #ef4444;
            font-weight: 600;
        }

        /* Empire Content */
        .empire-content {
            flex: 1;
            padding: 20px;
            padding-bottom: 100px;
            overflow-y: auto;
        }

        .empire-section {
            margin-bottom: 24px;
        }

        .empire-section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .empire-section-icon {
            font-size: 20px;
        }

        .empire-section-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .empire-section-title.assets {
            color: #10b981;
        }

        .empire-section-title.liabilities {
            color: #ef4444;
        }

        .empire-add-btn {
            margin-left: auto;
            padding: 6px 12px;
            border: none;
            border-radius: 15px;
            font-family: 'DM Sans', sans-serif;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .empire-add-btn.assets {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .empire-add-btn.liabilities {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .empire-list {
            background: var(--bg-card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .empire-item {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .empire-item:last-child {
            border-bottom: none;
        }

        .empire-item:active {
            background: var(--bg-accent);
        }

        .empire-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 12px;
        }

        .empire-item-icon.asset {
            background: rgba(16, 185, 129, 0.15);
        }

        .empire-item-icon.liability {
            background: rgba(239, 68, 68, 0.15);
        }

        .empire-item-info {
            flex: 1;
        }

        .empire-item-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .empire-item-category {
            font-size: 11px;
            color: var(--text-muted);
        }

        .empire-item-value {
            font-family: 'Fraunces', serif;
            font-size: 16px;
            font-weight: 700;
        }

        .empire-item-value.asset {
            color: #10b981;
        }

        .empire-item-value.liability {
            color: #ef4444;
        }

        .empire-section-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: var(--bg-accent);
            border-radius: 0 0 var(--radius) var(--radius);
            margin-top: -1px;
        }

        .empire-total-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .empire-total-label.assets {
            color: #10b981;
        }

        .empire-total-label.liabilities {
            color: #ef4444;
        }

        .empire-total-value {
            font-family: 'Fraunces', serif;
            font-size: 20px;
            font-weight: 700;
        }

        .empire-total-value.assets {
            color: #10b981;
        }

        .empire-total-value.liabilities {
            color: #ef4444;
        }

        /* Empire Empty State */
        .empire-empty {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-muted);
        }

        .empire-empty-icon {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }

        .empire-empty-text {
            font-size: 13px;
        }

        /* Asset/Liability Type Grid */
        .empire-type-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .empire-type-item {
            padding: 14px 8px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .empire-type-item.active.asset {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .empire-type-item.active.liability {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .empire-type-item-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .empire-type-item-label {
            font-size: 11px;
            font-weight: 600;
        }

        /* Quick Stats */
        .empire-quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 16px 20px;
        }

        .empire-stat {
            text-align: center;
            padding: 12px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
        }

        .empire-stat-value {
            font-family: 'Fraunces', serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-green);
        }

        .empire-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* Settings Page Styles */
        .settings-page-content {
            padding: 20px;
            padding-bottom: 100px;
            overflow-y: auto;
        }

        /* Recurring Subscriptions Page */
        .recurring-page {
            background: var(--bg-primary);
            min-height: 100vh;
        }

        .recurring-header {
            padding: 24px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        .recurring-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .recurring-header-left h1 {
            font-family: 'Fraunces', serif;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .recurring-header-left p {
            font-size: 13px;
            color: var(--text-muted);
        }

        .recurring-totals {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .recurring-total-card {
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
        }

        .recurring-total-card.monthly {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
        }

        .recurring-total-card.yearly {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
        }

        .recurring-total-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .recurring-total-value {
            font-family: 'Fraunces', serif;
            font-size: 32px;
            font-weight: 700;
        }

        .recurring-content {
            padding: 20px;
            padding-bottom: 120px;
        }

        .recurring-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recurring-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recurring-item {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }

        .recurring-item:active {
            transform: scale(0.98);
        }

        .recurring-item-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: var(--accent-green-light);
            flex-shrink: 0;
        }

        .recurring-item-icon.streaming { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .recurring-item-icon.music { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .recurring-item-icon.fitness { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        .recurring-item-icon.shopping { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .recurring-item-icon.cloud { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .recurring-item-icon.gaming { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .recurring-item-icon.phone { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .recurring-item-icon.vpn { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
        .recurring-item-icon.other { background: linear-gradient(135deg, #64748b 0%, #475569 100%); }

        .recurring-item-details {
            flex: 1;
            min-width: 0;
        }

        .recurring-item-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recurring-item-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .recurring-item-cycle {
            background: var(--bg-accent);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .recurring-item-amounts {
            text-align: right;
            flex-shrink: 0;
        }

        .recurring-item-monthly {
            font-family: 'Fraunces', serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .recurring-item-yearly {
            font-size: 12px;
            color: var(--accent-red);
            font-weight: 600;
        }

        .recurring-item-actions {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-left: 8px;
        }

        .recurring-item-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--bg-accent);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .recurring-item-action-btn:hover {
            background: var(--border);
        }

        .recurring-item-action-btn.delete {
            color: var(--accent-red);
        }

        .recurring-empty {
            text-align: center;
            padding: 60px 20px;
            background: var(--bg-card);
            border-radius: var(--radius);
        }

        .recurring-empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .recurring-empty-title {
            font-family: 'Fraunces', serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .recurring-empty-text {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        .add-subscription-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 16px;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: 'DM Sans', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
            transition: all 0.2s ease;
        }

        .add-subscription-btn:active {
            transform: scale(0.98);
        }

        /* Summary Stats Row */
        .recurring-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .recurring-stat {
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            padding: 14px;
            text-align: center;
        }

        .recurring-stat-value {
            font-family: 'Fraunces', serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-green);
        }

        .recurring-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* Subscription type grid */
        .subscription-type-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .subscription-type-item {
            padding: 14px 10px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .subscription-type-item.active {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
        }

        .subscription-type-item-icon {
            font-size: 24px;
            margin-bottom: 6px;
        }

        .subscription-type-item-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .billing-cycle-options {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .billing-cycle-option {
            flex: 1;
            padding: 14px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .billing-cycle-option.active {
            border-color: var(--accent-green);
            background: var(--accent-green-light);
            color: var(--accent-green);
        }

        /* Upcoming bills highlight */
        .recurring-item.due-soon .recurring-item-icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .due-badge {
            background: var(--accent-red);
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 700;
        }

        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            padding-left: 4px;
        }

        .settings-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
        }

        .settings-card .input-group {
            margin-bottom: 0;
        }

        .settings-card .custom-category-input {
            margin-bottom: 0;
        }

        @media (min-width: 431px) {
            .app {
                border-left: 1px solid var(--border);
                border-right: 1px solid var(--border);
            }
        }
    </style>
</head>
<body>
    <!-- ONBOARDING -->
    <div class="onboarding" id="onboarding">
        <div class="slides-container">
            <div class="slide active" id="slide-0">
                <div class="slide-icon"></div>
                <h1 class="slide-title">Welcome to<br><span>CashFlow Pro</span></h1>
                <p class="slide-text">Your all-in-one personal finance companion. Take control of your money today.</p>
            </div>

            <div class="slide" id="slide-1">
                <div class="slide-icon"></div>
                <h1 class="slide-title">Track Everything</h1>
                <p class="slide-text">Log income and expenses in seconds with beautiful insights.</p>
                <div class="slide-features">
                    <div class="slide-feature"> Quick transaction entry</div>
                    <div class="slide-feature"> Smart categories</div>
                    <div class="slide-feature"> Monthly reports</div>
                </div>
            </div>

            <div class="slide" id="slide-2">
                <div class="slide-icon"></div>
                <h1 class="slide-title">Crush Your Debts</h1>
                <p class="slide-text">Use proven strategies to become debt-free faster.</p>
                <div class="slide-features">
                    <div class="slide-feature"> Avalanche & Snowball methods</div>
                    <div class="slide-feature"> Auto-payment tracking</div>
                    <div class="slide-feature"> Progress celebrations</div>
                </div>
            </div>

            <div class="slide" id="slide-3">
                <div class="slide-icon"></div>
                <h1 class="slide-title">Build Your Empire</h1>
                <p class="slide-text">Set goals, track net worth, and watch your wealth grow.</p>
                <div class="slide-features">
                    <div class="slide-feature"> Savings goals</div>
                    <div class="slide-feature"> Net worth tracking</div>
                    <div class="slide-feature"> Financial health score</div>
                </div>
            </div>

            <div class="slide" id="slide-4">
                <div class="slide-icon"></div>
                <h1 class="slide-title">Let's Go!</h1>
                <p class="slide-text">What should we call you?</p>
                <input type="text" class="name-input" id="nameInput" placeholder="Enter your name">
            </div>
        </div>

        <div class="nav-container">
            <div class="dots">
                <div class="dot active" data-slide="0"></div>
                <div class="dot" data-slide="1"></div>
                <div class="dot" data-slide="2"></div>
                <div class="dot" data-slide="3"></div>
                <div class="dot" data-slide="4"></div>
            </div>
            <div class="nav-buttons">
                <button class="btn-skip" id="btnSkip">Skip</button>
                <button class="btn-next" id="btnNext">Next </button>
            </div>
        </div>
    </div>
    <script>
        // Check if already completed - hide onboarding
        if (localStorage.getItem('pocketflow_welcomed') === 'true') {
            document.getElementById('onboarding').classList.add('hidden');
        }
    </script>

    <div class="app">
        <!-- Cash Flow Page -->
        <div class="page active" id="page-cashflow">
            <!-- Global Header -->
            <div class="global-header">
                <div class="header-left">
                    <div>
                        <div class="user-greeting" id="greetingText">Good morning,</div>
                        <div class="user-name" id="userName">Friend</div>
                    </div>
                </div>
                <div class="header-right header-buttons">
                    <button class="settings-btn" onclick="switchPage('settings')" title="Settings"></button>
                    <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn1"></button>
                </div>
            </div>

            <!-- Balance Overview -->
            <div class="balance-overview">
                <div class="balance-main">
                    <div class="balance-main-label">Available Balance</div>
                    <div class="balance-main-value" id="balance">$0.00</div>
                </div>
                <div class="balance-row">
                    <div class="balance-item">
                        <div class="balance-item-value income" id="totalIncome">$0</div>
                        <div class="balance-item-label">Income</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-item-value expense" id="totalExpense">$0</div>
                        <div class="balance-item-label">Expenses</div>
                    </div>
                </div>
            </div>

            <!-- Quick Add Buttons -->
            <div class="quick-add-row">
                <button class="quick-add-btn income" onclick="openModal('income')">
                    <span>+</span> Income
                </button>
                <button class="quick-add-btn expense" onclick="openModal('expense')">
                    <span></span> Expense
                </button>
            </div>

            <!-- Categories Overview -->
            <div class="categories-overview">
                <div class="section-header">
                    <h2 class="section-title">Spending by Category</h2>
                </div>
                <div class="categories-scroll" id="categoriesScroll"></div>
            </div>

            <!-- Transactions Section -->
            <section class="transactions-section" style="margin-top: 0; border-radius: var(--radius) var(--radius) 0 0;">
                <div class="section-header">
                    <h2 class="section-title">Recent Transactions</h2>
                    <span class="date-display" id="currentDate"></span>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search transactions...">
                </div>
                <div class="transaction-list" id="transactionList"></div>
                <p class="delete-hint" id="deleteHint" style="display: none;">Tap a transaction to delete it</p>
            </section>
        </div>
        <!-- End Cash Flow Page -->

        <!-- Debt Crusher Page -->
        <div class="page" id="page-debt">
            <div class="debt-header">
                <div class="debt-header-top">
                    <div class="debt-header-left">
                        <h1>Debt Crusher</h1>
                        <p>Track and eliminate your debts</p>
                    </div>
                    <div class="header-buttons">
                        <button class="settings-btn" onclick="switchPage('settings')" title="Settings"></button>
                        <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn2"></button>
                    </div>
                </div>
                <div class="debt-summary-cards">
                    <div class="debt-summary-card total">
                        <div class="debt-summary-label">Total Remaining</div>
                        <div class="debt-summary-value" id="totalDebt">$0</div>
                    </div>
                    <div class="debt-summary-card">
                        <div class="debt-summary-label">Total Paid Off</div>
                        <div class="debt-summary-value" id="totalPaidAmount">$0</div>
                    </div>
                </div>
            </div>

            <div class="quick-stats-bar" id="quickStatsBar" style="display: none;">
                <div class="quick-stat">
                    <span class="quick-stat-icon"></span>
                    <span class="quick-stat-text"><span class="quick-stat-value" id="debtsPaidOff">0</span> paid off</span>
                </div>
                <div class="quick-stat">
                    <span class="quick-stat-icon"></span>
                    <span class="quick-stat-text"><span class="quick-stat-value" id="avgProgress">0%</span> progress</span>
                </div>
                <div class="quick-stat">
                    <span class="quick-stat-icon"></span>
                    <span class="quick-stat-text"><span class="quick-stat-value" id="nextAutoPayment">-</span></span>
                </div>
            </div>

            <div class="strategy-pills" id="strategyPills" style="display: none;">
                <div class="strategy-pill active" data-strategy="avalanche" onclick="selectStrategy('avalanche')">
                    <span class="strategy-pill-icon"></span>
                    Avalanche (High Interest)
                </div>
                <div class="strategy-pill" data-strategy="snowball" onclick="selectStrategy('snowball')">
                    <span class="strategy-pill-icon"></span>
                    Snowball (Low Balance)
                </div>
            </div>

            <div class="debt-content">
                <!-- Empty State -->
                <div class="debt-empty-state" id="debtEmptyState">
                    <div class="debt-empty-icon"></div>
                    <h2 class="debt-empty-title">Start Crushing Your Debt</h2>
                    <p class="debt-empty-text">Add your debts to track your progress,<br>set up auto-payments, and become debt-free!</p>
                    <button class="start-here-btn" onclick="openDebtModal()">
                        <span></span> Add Your First Debt
                    </button>
                </div>

                <!-- Debt List (hidden when empty) -->
                <div id="debtListContainer" style="display: none;">
                    <div class="debt-section-header">
                        <h2 class="debt-section-title">Your Debts</h2>
                        <button class="add-debt-text-btn" onclick="openDebtModal()">
                            <span>+</span> Add Debt
                        </button>
                    </div>
                    <div id="debtList"></div>
                </div>
            </div>
        </div>
        <!-- End Debt Crusher Page -->

        <!-- Wealth Builder Page -->
        <div class="page" id="page-wealth">
            <div class="wealth-header">
                <div class="wealth-header-top">
                    <div class="wealth-header-left">
                        <h1>Wealth Builder</h1>
                        <p>Save towards your goals</p>
                    </div>
                    <div class="header-buttons">
                        <button class="settings-btn" onclick="switchPage('settings')" title="Settings"></button>
                        <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn3"></button>
                    </div>
                </div>
                <div class="wealth-summary-cards">
                    <div class="wealth-summary-card saved">
                        <div class="wealth-summary-label">Total Saved</div>
                        <div class="wealth-summary-value" id="totalSaved">$0</div>
                    </div>
                    <div class="wealth-summary-card target">
                        <div class="wealth-summary-label">Target Amount</div>
                        <div class="wealth-summary-value" id="totalTarget">$0</div>
                    </div>
                </div>
            </div>

            <div class="goals-quick-stats" id="goalsQuickStats" style="display: none;">
                <div class="goals-quick-stat">
                    <span class="goals-quick-stat-icon"></span>
                    <span class="goals-quick-stat-text"><span class="goals-quick-stat-value" id="goalsCompleted">0</span> completed</span>
                </div>
                <div class="goals-quick-stat">
                    <span class="goals-quick-stat-icon"></span>
                    <span class="goals-quick-stat-text"><span class="goals-quick-stat-value" id="goalsProgress">0%</span> overall</span>
                </div>
                <div class="goals-quick-stat">
                    <span class="goals-quick-stat-icon"></span>
                    <span class="goals-quick-stat-text"><span class="goals-quick-stat-value" id="goalsRemaining">$0</span> to go</span>
                </div>
            </div>

            <div class="goals-content">
                <!-- Empty State -->
                <div class="goals-empty-state" id="goalsEmptyState">
                    <div class="goals-empty-icon"></div>
                    <h2 class="goals-empty-title">Start Building Wealth</h2>
                    <p class="goals-empty-text">Set savings goals for your dreams,<br>track progress, and automate your savings!</p>
                    <button class="start-saving-btn" onclick="openGoalModal()">
                        <span></span> Create Your First Goal
                    </button>
                </div>

                <!-- Goals List -->
                <div id="goalsListContainer" style="display: none;">
                    <div class="debt-section-header">
                        <h2 class="debt-section-title">Your Goals</h2>
                        <button class="add-debt-text-btn" onclick="openGoalModal()" style="background: rgba(5,150,105,0.15); color: #059669;">
                            <span>+</span> Add Goal
                        </button>
                    </div>
                    <div id="goalsList"></div>
                </div>
            </div>
        </div>
        <!-- End Wealth Builder Page -->

        <!-- Empire (Net Worth) Page -->
        <div class="page" id="page-empire">
            <div class="empire-header">
                <div class="empire-header-top">
                    <div class="empire-header-left">
                        <h1>Empire</h1>
                        <p>Track your net worth</p>
                    </div>
                    <div class="header-buttons">
                        <button class="settings-btn" onclick="switchPage('settings')" title="Settings"></button>
                        <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn4"></button>
                    </div>
                </div>
            </div>

            <div class="net-worth-display">
                <div class="net-worth-label">Net Worth</div>
                <div class="net-worth-value positive" id="netWorthValue">$0</div>
                <div class="net-worth-bar">
                    <div class="net-worth-bar-assets" id="assetsBar" style="width: 50%"></div>
                    <div class="net-worth-bar-liabilities" id="liabilitiesBar" style="width: 50%"></div>
                </div>
                <div class="net-worth-bar-labels">
                    <span class="assets-label" id="assetsBarLabel">$0 Assets</span>
                    <span class="liabilities-label" id="liabilitiesBarLabel">$0 Liabilities</span>
                </div>
            </div>

            <div class="empire-quick-stats">
                <div class="empire-stat">
                    <div class="empire-stat-value" id="assetCount">0</div>
                    <div class="empire-stat-label">Assets</div>
                </div>
                <div class="empire-stat">
                    <div class="empire-stat-value" id="liabilityCount">0</div>
                    <div class="empire-stat-label">Liabilities</div>
                </div>
                <div class="empire-stat">
                    <div class="empire-stat-value" id="wealthRatio">0%</div>
                    <div class="empire-stat-label">Wealth Ratio</div>
                </div>
            </div>

            <div class="empire-content">
                <!-- Assets Section -->
                <div class="empire-section">
                    <div class="empire-section-header">
                        <span class="empire-section-icon"></span>
                        <span class="empire-section-title assets">Assets</span>
                        <button class="empire-add-btn assets" onclick="openEmpireModal('asset')">+ Add</button>
                    </div>
                    <div class="empire-list" id="assetsList">
                        <div class="empire-empty">
                            <div class="empire-empty-icon"></div>
                            <p class="empire-empty-text">No assets yet. Add your first!</p>
                        </div>
                    </div>
                </div>

                <!-- Liabilities Section -->
                <div class="empire-section">
                    <div class="empire-section-header">
                        <span class="empire-section-icon"></span>
                        <span class="empire-section-title liabilities">Liabilities</span>
                        <button class="empire-add-btn liabilities" onclick="openEmpireModal('liability')">+ Add</button>
                    </div>
                    <div class="empire-list" id="liabilitiesList">
                        <div class="empire-empty">
                            <div class="empire-empty-icon"></div>
                            <p class="empire-empty-text">No liabilities. Great job!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Empire Page -->

        <!-- Recurring Subscriptions Page -->
        <div class="page recurring-page" id="page-recurring">
            <div class="recurring-header">
                <div class="recurring-header-top">
                    <div class="recurring-header-left">
                        <h1>Subscriptions</h1>
                        <p>Track your recurring payments</p>
                    </div>
                    <div class="header-buttons">
                        <button class="settings-btn" onclick="switchPage('settings')" title="Settings"></button>
                        <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn5"></button>
                    </div>
                </div>
                <div class="recurring-totals">
                    <div class="recurring-total-card monthly">
                        <div class="recurring-total-label">Monthly Total</div>
                        <div class="recurring-total-value" id="recurringMonthlyTotal">$0</div>
                    </div>
                    <div class="recurring-total-card yearly">
                        <div class="recurring-total-label">Yearly Cost</div>
                        <div class="recurring-total-value" id="recurringYearlyTotal">$0</div>
                    </div>
                </div>
            </div>

            <div class="recurring-content">
                <!-- Stats Row -->
                <div class="recurring-stats" id="recurringStats">
                    <div class="recurring-stat">
                        <div class="recurring-stat-value" id="recurringCount">0</div>
                        <div class="recurring-stat-label">Active</div>
                    </div>
                    <div class="recurring-stat">
                        <div class="recurring-stat-value" id="recurringAvg">$0</div>
                        <div class="recurring-stat-label">Avg/Month</div>
                    </div>
                    <div class="recurring-stat">
                        <div class="recurring-stat-value" id="recurringNext">-</div>
                        <div class="recurring-stat-label">Next Bill</div>
                    </div>
                </div>

                <!-- Subscriptions List -->
                <div id="recurringListContainer">
                    <div class="recurring-section-title">
                        <span></span> Your Subscriptions
                    </div>
                    <div class="recurring-list" id="recurringList">
                        <!-- Subscriptions will be rendered here -->
                    </div>
                </div>

                <div class="recurring-empty" id="recurringEmpty" style="display: none;">
                    <div class="recurring-empty-icon"></div>
                    <div class="recurring-empty-title">No Subscriptions Yet</div>
                    <div class="recurring-empty-text">Start tracking your Netflix, Spotify, gym membership and more!</div>
                </div>

                <button class="add-subscription-btn" onclick="openSubscriptionModal()">
                    <span></span> Add Subscription
                </button>
            </div>
        </div>
        <!-- End Recurring Page -->

        <!-- Financial Health Score Page -->
        <div class="page" id="page-health">
            <div class="health-header">
                <div class="health-header-top">
                    <div class="health-header-left">
                        <h1>Financial Health</h1>
                        <p>Your overall financial wellness</p>
                    </div>
                    <div class="header-buttons">
                        <button class="settings-btn" onclick="switchPage('settings')" title="Settings"></button>
                        <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn6"></button>
                    </div>
                </div>
            </div>

            <div class="health-score-container">
                <div class="health-score-circle">
                    <svg class="health-score-svg" viewBox="0 0 200 200">
                        <circle class="health-score-bg" cx="100" cy="100" r="88"></circle>
                        <circle class="health-score-progress" id="healthScoreCircle" cx="100" cy="100" r="88" 
                            stroke-dasharray="553" stroke-dashoffset="553"></circle>
                    </svg>
                    <div class="health-score-text">
                        <div class="health-score-value" id="healthScoreValue">0</div>
                        <div class="health-score-label">out of 100</div>
                    </div>
                </div>
            </div>

            <div class="health-score-status" id="healthScoreStatus">
                <div class="health-score-status-text" id="healthStatusText">Calculating...</div>
                <div class="health-score-status-desc" id="healthStatusDesc">Add some data to see your score</div>
            </div>

            <div class="health-content">
                <div class="health-section">
                    <div class="health-section-title">
                        <span></span> Key Metrics
                    </div>
                    <div class="health-metrics">
                        <div class="health-metric-card">
                            <div class="health-metric-header">
                                <div class="health-metric-left">
                                    <div class="health-metric-icon good" id="savingsRateIcon"></div>
                                    <div class="health-metric-name">Savings Rate</div>
                                </div>
                                <div class="health-metric-value good" id="savingsRateValue">0%</div>
                            </div>
                            <div class="health-metric-bar">
                                <div class="health-metric-bar-fill good" id="savingsRateBar" style="width: 0%"></div>
                            </div>
                            <div class="health-metric-hint" id="savingsRateHint">Aim for 20% or more of your income</div>
                        </div>

                        <div class="health-metric-card">
                            <div class="health-metric-header">
                                <div class="health-metric-left">
                                    <div class="health-metric-icon good" id="budgetAdherenceIcon"></div>
                                    <div class="health-metric-name">Budget Adherence</div>
                                </div>
                                <div class="health-metric-value good" id="budgetAdherenceValue">0%</div>
                            </div>
                            <div class="health-metric-bar">
                                <div class="health-metric-bar-fill good" id="budgetAdherenceBar" style="width: 0%"></div>
                            </div>
                            <div class="health-metric-hint" id="budgetAdherenceHint">Stay within your monthly budget</div>
                        </div>

                        <div class="health-metric-card">
                            <div class="health-metric-header">
                                <div class="health-metric-left">
                                    <div class="health-metric-icon good" id="debtRatioIcon"></div>
                                    <div class="health-metric-name">Debt-to-Income</div>
                                </div>
                                <div class="health-metric-value good" id="debtRatioValue">0%</div>
                            </div>
                            <div class="health-metric-bar">
                                <div class="health-metric-bar-fill good" id="debtRatioBar" style="width: 0%"></div>
                            </div>
                            <div class="health-metric-hint" id="debtRatioHint">Keep debt payments under 36% of income</div>
                        </div>

                        <div class="health-metric-card">
                            <div class="health-metric-header">
                                <div class="health-metric-left">
                                    <div class="health-metric-icon good" id="emergencyFundIcon"></div>
                                    <div class="health-metric-name">Emergency Fund</div>
                                </div>
                                <div class="health-metric-value good" id="emergencyFundValue">0 mo</div>
                            </div>
                            <div class="health-metric-bar">
                                <div class="health-metric-bar-fill good" id="emergencyFundBar" style="width: 0%"></div>
                            </div>
                            <div class="health-metric-hint" id="emergencyFundHint">Aim for 3-6 months of expenses saved</div>
                        </div>

                        <div class="health-metric-card">
                            <div class="health-metric-header">
                                <div class="health-metric-left">
                                    <div class="health-metric-icon good" id="netWorthIcon"></div>
                                    <div class="health-metric-name">Net Worth Trend</div>
                                </div>
                                <div class="health-metric-value good" id="netWorthValue">$0</div>
                            </div>
                            <div class="health-metric-bar">
                                <div class="health-metric-bar-fill good" id="netWorthBar" style="width: 0%"></div>
                            </div>
                            <div class="health-metric-hint" id="netWorthHint">Growing net worth is key to financial freedom</div>
                        </div>
                    </div>
                </div>

                <div class="health-section">
                    <div class="health-section-title">
                        <span></span> Tips to Improve
                    </div>
                    <div class="health-tips" id="healthTips">
                        <!-- Tips will be rendered here -->
                    </div>
                </div>
            </div>
        </div>
        <!-- End Health Score Page -->

        <!-- Financial Health Score Page -->
        <div class="page" id="page-health">
            <div class="health-header">
                <div class="health-header-top">
                    <h1> Financial Health</h1>
                    <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn6"></button>
                </div>
                
                <div class="health-score-circle">
                    <div class="health-score-ring" id="healthScoreRing" style="--score: 0; --score-color: #10b981;">
                        <div class="health-score-value" id="healthScoreValue">0</div>
                    </div>
                </div>
                <div class="health-score-label">Your Financial Health Score</div>
                <div class="health-score-status" id="healthScoreStatus">Calculating...</div>
            </div>

            <div class="health-content">
                <div class="health-section-title">
                    <span></span> Score Breakdown
                </div>
                <div class="health-metrics" id="healthMetrics">
                    <!-- Metrics will be rendered here -->
                </div>

                <div class="health-section-title">
                    <span></span> Tips to Improve
                </div>
                <div class="health-tips" id="healthTips">
                    <!-- Tips will be rendered here -->
                </div>
            </div>
        </div>
        <!-- End Health Score Page -->

        <!-- Settings Page -->
        <div class="page" id="page-settings">
            <div class="global-header">
                <div class="header-left">
                    <div>
                        <div class="user-name">Settings</div>
                    </div>
                </div>
                <div class="header-right">
                    <button class="dark-mode-btn" onclick="toggleDarkMode()" id="darkModeBtn7"></button>
                </div>
            </div>

            <div class="settings-page-content">
                <!-- Profile Section -->
                <div class="settings-section">
                    <div class="settings-section-title"> Profile</div>
                    <div class="settings-card">
                        <div class="input-group" style="margin-bottom: 0;">
                            <label class="input-label">Your Name</label>
                            <input type="text" class="input-field" id="userNameInput" placeholder="Enter your name">
                        </div>
                    </div>
                </div>

                <!-- Budget Section -->
                <div class="settings-section">
                    <div class="settings-section-title"> Budget</div>
                    <div class="settings-card">
                        <div class="input-group" style="margin-bottom: 16px;">
                            <label class="input-label">Monthly Budget</label>
                            <div class="amount-input-wrapper">
                                <span class="currency-symbol">$</span>
                                <input type="number" class="input-field amount-input" id="settingsBudgetInput" placeholder="0.00" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="input-group" style="margin-bottom: 0;">
                            <label class="input-label">Currency</label>
                            <div class="currency-grid">
                                <div class="currency-option active" data-currency="$" data-code="USD" onclick="selectCurrency(this, '$', 'USD')">$ USD</div>
                                <div class="currency-option" data-currency="" data-code="EUR" onclick="selectCurrency(this, '', 'EUR')"> EUR</div>
                                <div class="currency-option" data-currency="" data-code="GBP" onclick="selectCurrency(this, '', 'GBP')"> GBP</div>
                                <div class="currency-option" data-currency="" data-code="JPY" onclick="selectCurrency(this, '', 'JPY')"> JPY</div>
                                <div class="currency-option" data-currency="" data-code="INR" onclick="selectCurrency(this, '', 'INR')"> INR</div>
                                <div class="currency-option" data-currency="" data-code="KRW" onclick="selectCurrency(this, '', 'KRW')"> KRW</div>
                                <div class="currency-option" data-currency="C$" data-code="CAD" onclick="selectCurrency(this, 'C$', 'CAD')">C$ CAD</div>
                                <div class="currency-option" data-currency="A$" data-code="AUD" onclick="selectCurrency(this, 'A$', 'AUD')">A$ AUD</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Appearance Section -->
                <div class="settings-section">
                    <div class="settings-section-title"> Appearance</div>
                    <div class="settings-card">
                        <div class="input-group" style="margin-bottom: 16px;">
                            <label class="input-label">Color Theme</label>
                            <div class="theme-picker">
                                <div class="theme-option th-sage active" data-theme="" title="Sage" onclick="selectTheme(this, '')"></div>
                                <div class="theme-option th-ocean" data-theme="theme-ocean" title="Ocean" onclick="selectTheme(this, 'theme-ocean')"></div>
                                <div class="theme-option th-sunset" data-theme="theme-sunset" title="Sunset" onclick="selectTheme(this, 'theme-sunset')"></div>
                                <div class="theme-option th-lavender" data-theme="theme-lavender" title="Lavender" onclick="selectTheme(this, 'theme-lavender')"></div>
                                <div class="theme-option th-rose" data-theme="theme-rose" title="Rose" onclick="selectTheme(this, 'theme-rose')"></div>
                                <div class="theme-option th-forest" data-theme="theme-forest" title="Forest" onclick="selectTheme(this, 'theme-forest')"></div>
                            </div>
                            <p style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">Themes disabled when dark mode is on</p>
                        </div>
                    </div>
                </div>

                <!-- Categories Section -->
                <div class="settings-section">
                    <div class="settings-section-title"> Custom Categories</div>
                    <div class="settings-card">
                        <div class="custom-category-input">
                            <button class="emoji-picker-btn" id="selectedEmoji" onclick="toggleEmojiPicker()"></button>
                            <input type="text" class="input-field" id="newCategoryName" placeholder="Category name" style="flex:1">
                            <button class="quick-add-btn income" onclick="addCustomCategory()" style="padding: 14px 18px;">+</button>
                        </div>
                        <div class="emoji-grid" id="emojiGrid" style="display: none;"></div>
                        <div id="categoryList" style="margin-top: 12px;"></div>
                    </div>
                </div>

                <!-- Data Section -->
                <div class="settings-section">
                    <div class="settings-section-title"> Data</div>
                    <div class="settings-card">
                        <button class="export-btn" onclick="exportData()"> Export Data (JSON)</button>
                        <button class="export-btn" onclick="exportCSV()"> Export as CSV</button>
                        <label class="export-btn" style="cursor: pointer;">
                             Import Data
                            <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                        </label>
                    </div>
                </div>

                <!-- Welcome Tour -->
                <div class="settings-section">
                    <div class="settings-section-title"> Welcome Tour</div>
                    <div class="settings-card">
                        <button class="submit-btn" onclick="replayOnboarding()" style="width: 100%; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);"> Replay Welcome Tour</button>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="settings-section">
                    <div class="settings-section-title" style="color: var(--accent-red);"> Danger Zone</div>
                    <div class="settings-card">
                        <button class="reset-btn" onclick="resetData()" style="width: 100%;"> Reset All Data</button>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="settings-section">
                    <button class="submit-btn income" onclick="saveAllSettings()" style="width: 100%;">Save Settings</button>
                </div>
            </div>
        </div>
        <!-- End Settings Page -->

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchPage('cashflow')">
                <span class="nav-icon"></span>
                <span class="nav-label">Cash</span>
            </button>
            <button class="nav-item" onclick="switchPage('debt')">
                <span class="nav-icon"></span>
                <span class="nav-label">Debt</span>
            </button>
            <button class="nav-item" onclick="switchPage('wealth')">
                <span class="nav-icon"></span>
                <span class="nav-label">Goals</span>
            </button>
            <button class="nav-item" onclick="switchPage('empire')">
                <span class="nav-icon"></span>
                <span class="nav-label">Empire</span>
            </button>
            <button class="nav-item" onclick="switchPage('recurring')">
                <span class="nav-icon"></span>
                <span class="nav-label">Subs</span>
            </button>
            <button class="nav-item" onclick="switchPage('health')">
                <span class="nav-icon"></span>
                <span class="nav-label">Health</span>
            </button>
        </nav>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal-overlay" id="transactionModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close-btn" onclick="closeModal('transactionModal')"></button>
                <h2 class="modal-title" id="modalTitle">Add Expense</h2>
                <div style="width: 32px;"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">Amount</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="amountInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Description</label>
                <input type="text" class="input-field" id="descriptionInput" placeholder="What was it for?">
            </div>

            <div class="input-group" id="categoryGroup">
                <label class="input-label">Category</label>
                <div class="modal-categories" id="modalCategories"></div>
            </div>

            <div class="recurring-toggle">
                <span style="font-size: 14px; font-weight: 500;">Recurring Transaction</span>
                <div class="toggle-switch" id="recurringToggle" onclick="toggleRecurring()"></div>
            </div>
            <div class="frequency-selector" id="frequencySelector">
                <div class="frequency-option active" data-freq="weekly">Weekly</div>
                <div class="frequency-option" data-freq="biweekly">Bi-weekly</div>
                <div class="frequency-option" data-freq="monthly">Monthly</div>
            </div>

            <div class="modal-actions">
                <button class="modal-cancel-btn" onclick="closeModal('transactionModal')">Cancel</button>
                <button class="modal-save-btn expense" id="submitBtn" onclick="addTransaction()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add Debt Modal -->
    <div class="modal-overlay debt-modal" id="debtModal">
        <div class="modal" style="max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <button class="modal-close-btn" onclick="closeModal('debtModal')"></button>
                <h2 class="modal-title" id="debtModalTitle">Add Debt</h2>
                <div style="width: 32px;"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">Debt Type</label>
                <div class="debt-type-grid">
                    <div class="debt-type-item active" data-type="credit" data-icon="" onclick="selectDebtType(this, 'credit', '')">
                        <div class="debt-type-item-icon"></div>
                        <div class="debt-type-item-label">Credit Card</div>
                    </div>
                    <div class="debt-type-item" data-type="auto" data-icon="" onclick="selectDebtType(this, 'auto', '')">
                        <div class="debt-type-item-icon"></div>
                        <div class="debt-type-item-label">Auto Loan</div>
                    </div>
                    <div class="debt-type-item" data-type="student" data-icon="" onclick="selectDebtType(this, 'student', '')">
                        <div class="debt-type-item-icon"></div>
                        <div class="debt-type-item-label">Student</div>
                    </div>
                    <div class="debt-type-item" data-type="mortgage" data-icon="" onclick="selectDebtType(this, 'mortgage', '')">
                        <div class="debt-type-item-icon"></div>
                        <div class="debt-type-item-label">Mortgage</div>
                    </div>
                    <div class="debt-type-item" data-type="personal" data-icon="" onclick="selectDebtType(this, 'personal', '')">
                        <div class="debt-type-item-icon"></div>
                        <div class="debt-type-item-label">Personal</div>
                    </div>
                    <div class="debt-type-item" data-type="other" data-icon="" onclick="selectDebtType(this, 'other', '')">
                        <div class="debt-type-item-icon"></div>
                        <div class="debt-type-item-label">Other</div>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Account Name</label>
                <input type="text" class="input-field" id="debtNameInput" placeholder="e.g., Chase Visa">
            </div>

            <div class="input-group">
                <label class="input-label">Original Amount</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="debtOriginalInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Current Balance</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="debtBalanceInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Interest Rate (APR %)</label>
                <input type="number" class="input-field" id="debtInterestInput" placeholder="0.00" step="0.01" min="0" max="100">
            </div>

            <div class="input-group">
                <label class="input-label">Payment Amount</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="debtMinPaymentInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Auto-Deduct Schedule</label>
                <div class="schedule-options">
                    <div class="schedule-option" data-schedule="none" onclick="selectDebtSchedule(this, 'none')">
                        <div class="schedule-option-title"> Off</div>
                        <div class="schedule-option-desc">Manual only</div>
                    </div>
                    <div class="schedule-option active" data-schedule="weekly" onclick="selectDebtSchedule(this, 'weekly')">
                        <div class="schedule-option-title"> Weekly</div>
                        <div class="schedule-option-desc">Every week</div>
                    </div>
                    <div class="schedule-option" data-schedule="biweekly" onclick="selectDebtSchedule(this, 'biweekly')">
                        <div class="schedule-option-title"> Bi-weekly</div>
                        <div class="schedule-option-desc">Every 2 weeks</div>
                    </div>
                    <div class="schedule-option" data-schedule="monthly" onclick="selectDebtSchedule(this, 'monthly')">
                        <div class="schedule-option-title"> Monthly</div>
                        <div class="schedule-option-desc">Once a month</div>
                    </div>
                </div>
                <div class="custom-schedule-row" id="customScheduleRow">
                    <input type="number" class="input-field" id="customDaysInput" placeholder="Days" min="1" max="365">
                    <span style="display: flex; align-items: center; color: var(--text-muted);">days</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Start Date</label>
                <input type="date" class="input-field" id="debtStartDateInput">
            </div>

            <div class="modal-actions">
                <button class="modal-cancel-btn" onclick="closeModal('debtModal')">Cancel</button>
                <button class="modal-save-btn income" id="debtSubmitBtn" onclick="addDebt()">Add Debt</button>
            </div>
            <button class="submit-btn secondary" id="debtDeleteBtn" onclick="deleteCurrentDebt()" style="display: none; margin-top: 10px; background: var(--accent-red-light); color: var(--accent-red);"> Delete Debt</button>
        </div>
    </div>

    <!-- Make Payment Modal -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close-btn" onclick="closeModal('paymentModal')"></button>
                <h2 class="modal-title">Make Payment</h2>
                <div style="width: 32px;"></div>
            </div>
            <p id="paymentDebtName" style="text-align:center; color: var(--text-secondary); margin-bottom: 20px;"></p>
            
            <div class="input-group">
                <label class="input-label">Payment Amount</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="paymentAmountInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-cancel-btn" onclick="closeModal('paymentModal')">Cancel</button>
                <button class="modal-save-btn income" onclick="makePayment()"> Crush It!</button>
            </div>
        </div>
    </div>

    <!-- Add Asset/Liability Modal -->
    <div class="modal-overlay" id="empireModal">
        <div class="modal" style="max-height: 85vh; overflow-y: auto;">
            <div class="modal-header">
                <button class="modal-close-btn" onclick="closeModal('empireModal')"></button>
                <h2 class="modal-title" id="empireModalTitle">Add Asset</h2>
                <div style="width: 32px;"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">Type</label>
                <div class="empire-type-grid" id="empireTypeGrid">
                    <!-- Filled dynamically -->
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Name</label>
                <input type="text" class="input-field" id="empireNameInput" placeholder="e.g., Savings Account">
            </div>

            <div class="input-group">
                <label class="input-label">Value</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="empireValueInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Notes (Optional)</label>
                <input type="text" class="input-field" id="empireNotesInput" placeholder="Any additional details">
            </div>

            <div class="modal-actions">
                <button class="modal-cancel-btn" onclick="closeModal('empireModal')">Cancel</button>
                <button class="modal-save-btn income" id="empireSubmitBtn" onclick="addEmpireItem()">Add Asset</button>
            </div>
            <button class="submit-btn secondary" id="empireDeleteBtn" onclick="deleteCurrentEmpireItem()" style="display: none; margin-top: 10px; background: var(--accent-red-light); color: var(--accent-red);"> Delete</button>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div class="modal-overlay" id="goalModal">
        <div class="modal" style="max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <button class="modal-close-btn" onclick="closeModal('goalModal')"></button>
                <h2 class="modal-title" id="goalModalTitle">Create Goal</h2>
                <div style="width: 32px;"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">Goal Type</label>
                <div class="goal-type-grid">
                    <div class="goal-type-item active" data-type="emergency" data-icon="" onclick="selectGoalType(this, 'emergency', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Emergency</div>
                    </div>
                    <div class="goal-type-item" data-type="vacation" data-icon="" onclick="selectGoalType(this, 'vacation', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Vacation</div>
                    </div>
                    <div class="goal-type-item" data-type="tech" data-icon="" onclick="selectGoalType(this, 'tech', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Tech</div>
                    </div>
                    <div class="goal-type-item" data-type="gift" data-icon="" onclick="selectGoalType(this, 'gift', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Gifts</div>
                    </div>
                    <div class="goal-type-item" data-type="house" data-icon="" onclick="selectGoalType(this, 'house', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">House</div>
                    </div>
                    <div class="goal-type-item" data-type="car" data-icon="" onclick="selectGoalType(this, 'car', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Car</div>
                    </div>
                    <div class="goal-type-item" data-type="education" data-icon="" onclick="selectGoalType(this, 'education', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Education</div>
                    </div>
                    <div class="goal-type-item" data-type="wedding" data-icon="" onclick="selectGoalType(this, 'wedding', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Wedding</div>
                    </div>
                    <div class="goal-type-item" data-type="other" data-icon="" onclick="selectGoalType(this, 'other', '')">
                        <div class="goal-type-item-icon"></div>
                        <div class="goal-type-item-label">Other</div>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Goal Name</label>
                <input type="text" class="input-field" id="goalNameInput" placeholder="e.g., Emergency Fund">
            </div>

            <div class="input-group">
                <label class="input-label">Target Amount</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="goalTargetInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Already Saved (Optional)</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="goalSavedInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Target Date</label>
                <input type="date" class="input-field" id="goalDueDateInput">
            </div>

            <div class="input-group">
                <label class="input-label">Auto-Save Schedule</label>
                <div class="schedule-options">
                    <div class="schedule-option" data-schedule="none" onclick="selectGoalSchedule(this, 'none')">
                        <div class="schedule-option-title"> Off</div>
                        <div class="schedule-option-desc">Manual only</div>
                    </div>
                    <div class="schedule-option active" data-schedule="weekly" onclick="selectGoalSchedule(this, 'weekly')">
                        <div class="schedule-option-title"> Weekly</div>
                        <div class="schedule-option-desc">Every week</div>
                    </div>
                    <div class="schedule-option" data-schedule="biweekly" onclick="selectGoalSchedule(this, 'biweekly')">
                        <div class="schedule-option-title"> Bi-weekly</div>
                        <div class="schedule-option-desc">Every 2 weeks</div>
                    </div>
                    <div class="schedule-option" data-schedule="monthly" onclick="selectGoalSchedule(this, 'monthly')">
                        <div class="schedule-option-title"> Monthly</div>
                        <div class="schedule-option-desc">Once a month</div>
                    </div>
                </div>
            </div>

            <div class="input-group" id="goalAutoAmountGroup">
                <label class="input-label">Auto-Save Amount</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="goalAutoAmountInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-cancel-btn" onclick="closeModal('goalModal')">Cancel</button>
                <button class="modal-save-btn income" id="goalSubmitBtn" onclick="addGoal()">Create Goal</button>
            </div>
            <button class="submit-btn secondary" id="goalDeleteBtn" onclick="deleteCurrentGoal()" style="display: none; margin-top: 10px; background: var(--accent-red-light); color: var(--accent-red);"> Delete Goal</button>
        </div>
    </div>

    <!-- Make Deposit Modal -->
    <div class="modal-overlay" id="depositModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close-btn" onclick="closeModal('depositModal')"></button>
                <h2 class="modal-title">Add Savings</h2>
                <div style="width: 32px;"></div>
            </div>
            <p id="depositGoalName" style="text-align:center; color: var(--text-secondary); margin-bottom: 20px;"></p>
            
            <div class="input-group">
                <label class="input-label">Amount to Save</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="depositAmountInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-cancel-btn" onclick="closeModal('depositModal')">Cancel</button>
                <button class="modal-save-btn income" onclick="makeDeposit()"> Save It!</button>
            </div>
        </div>
    </div>

    <!-- Goal Celebration Overlay -->
    <div class="goal-celebration-overlay" id="goalCelebrationOverlay">
        <div class="goal-celebration-content">
            <div class="goal-celebration-emoji"></div>
            <h2 class="goal-celebration-title">GOAL REACHED!</h2>
            <p class="goal-celebration-text" id="goalCelebrationText">You did it!</p>
            <button class="celebration-btn" onclick="closeGoalCelebration()">Celebrate! </button>
        </div>
    </div>

    <!-- Celebration Overlay -->
    <div class="celebration-overlay" id="celebrationOverlay">
        <div class="celebration-content">
            <div class="celebration-emoji"></div>
            <h2 class="celebration-title">DEBT CRUSHED!</h2>
            <p class="celebration-text" id="celebrationText">You paid off your debt!</p>
            <button class="celebration-btn" onclick="closeCelebration()">Keep Crushing! </button>
        </div>
    </div>

    <!-- Add Subscription Modal -->
    <div class="modal-overlay" id="subscriptionModal">
        <div class="modal" style="max-height: 85vh; overflow-y: auto;">
            <div class="modal-header">
                <button class="modal-close-btn" onclick="closeModal('subscriptionModal')"></button>
                <h2 class="modal-title" id="subscriptionModalTitle">Add Subscription</h2>
                <div style="width: 32px;"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">Service Type</label>
                <div class="subscription-type-grid">
                    <div class="subscription-type-item active" data-type="streaming" data-icon="" onclick="selectSubscriptionType(this, 'streaming', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Streaming</div>
                    </div>
                    <div class="subscription-type-item" data-type="music" data-icon="" onclick="selectSubscriptionType(this, 'music', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Music</div>
                    </div>
                    <div class="subscription-type-item" data-type="fitness" data-icon="" onclick="selectSubscriptionType(this, 'fitness', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Fitness</div>
                    </div>
                    <div class="subscription-type-item" data-type="shopping" data-icon="" onclick="selectSubscriptionType(this, 'shopping', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Shopping</div>
                    </div>
                    <div class="subscription-type-item" data-type="cloud" data-icon="" onclick="selectSubscriptionType(this, 'cloud', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Cloud</div>
                    </div>
                    <div class="subscription-type-item" data-type="gaming" data-icon="" onclick="selectSubscriptionType(this, 'gaming', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Gaming</div>
                    </div>
                    <div class="subscription-type-item" data-type="phone" data-icon="" onclick="selectSubscriptionType(this, 'phone', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Phone</div>
                    </div>
                    <div class="subscription-type-item" data-type="vpn" data-icon="" onclick="selectSubscriptionType(this, 'vpn', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">VPN</div>
                    </div>
                    <div class="subscription-type-item" data-type="other" data-icon="" onclick="selectSubscriptionType(this, 'other', '')">
                        <div class="subscription-type-item-icon"></div>
                        <div class="subscription-type-item-label">Other</div>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Service Name</label>
                <input type="text" class="input-field" id="subscriptionNameInput" placeholder="e.g., Netflix, Spotify">
            </div>

            <div class="input-group">
                <label class="input-label">Amount</label>
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="input-field amount-input" id="subscriptionAmountInput" placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Billing Cycle</label>
                <div class="billing-cycle-options">
                    <div class="billing-cycle-option active" data-cycle="monthly" onclick="selectBillingCycle(this, 'monthly')">Monthly</div>
                    <div class="billing-cycle-option" data-cycle="yearly" onclick="selectBillingCycle(this, 'yearly')">Yearly</div>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Next Billing Date</label>
                <input type="date" class="input-field" id="subscriptionBillDateInput">
            </div>

            <div class="modal-actions">
                <button class="modal-cancel-btn" onclick="closeModal('subscriptionModal')">Cancel</button>
                <button class="modal-save-btn income" id="subscriptionSubmitBtn" onclick="addSubscription()">Add Subscription</button>
            </div>
            <button class="submit-btn secondary" id="subscriptionDeleteBtn" onclick="deleteCurrentSubscription()" style="display: none; margin-top: 10px; background: var(--accent-red-light); color: var(--accent-red);"> Delete Subscription</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // Default Categories
        const defaultCategories = [
            { id: 'food', name: 'Food', icon: '', isDefault: true },
            { id: 'transport', name: 'Transport', icon: '', isDefault: true },
            { id: 'shopping', name: 'Shopping', icon: '', isDefault: true },
            { id: 'bills', name: 'Bills', icon: '', isDefault: true },
            { id: 'entertainment', name: 'Fun', icon: '', isDefault: true },
            { id: 'health', name: 'Health', icon: '', isDefault: true },
            { id: 'income', name: 'Income', icon: '', isDefault: true },
            { id: 'other', name: 'Other', icon: '', isDefault: true }
        ];

        // Emoji options for custom categories
        const emojiOptions = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];

        // State
        let categories = JSON.parse(localStorage.getItem('pocketflow_categories')) || [...defaultCategories];
        let transactions = JSON.parse(localStorage.getItem('pocketflow_transactions')) || [];
        let budget = parseFloat(localStorage.getItem('pocketflow_budget')) || 0;
        let currency = localStorage.getItem('pocketflow_currency') || '$';
        let currencyCode = localStorage.getItem('pocketflow_currency_code') || 'USD';
        let currentTheme = localStorage.getItem('pocketflow_theme') || '';
        let isDarkMode = localStorage.getItem('pocketflow_darkmode') === 'true';
        let isFirstTime = localStorage.getItem('pocketflow_welcomed') !== 'true';
        let userName = localStorage.getItem('pocketflow_username') || 'Friend';
        let currentType = 'expense';
        let editingTransactionIndex = null;
        let selectedCategory = 'food';
        let isRecurring = false;
        let recurringFrequency = 'monthly';
        let selectedEmoji = '';
        let searchQuery = '';

        // Debt Crusher State
        let debts = JSON.parse(localStorage.getItem('pocketflow_debts')) || [];
        let debtStrategy = localStorage.getItem('pocketflow_debt_strategy') || 'avalanche';
        let selectedDebtType = 'credit';
        let selectedDebtIcon = '';
        let selectedSchedule = 'weekly';
        let editingDebtId = null;
        let payingDebtId = null;

        // Wealth Builder State
        let goals = JSON.parse(localStorage.getItem('pocketflow_goals')) || [];
        let selectedGoalType = 'emergency';
        let selectedGoalIcon = '';
        let selectedGoalSchedule = 'weekly';
        let editingGoalId = null;
        let depositingGoalId = null;

        // Empire (Net Worth) State
        let assets = JSON.parse(localStorage.getItem('pocketflow_assets')) || [];
        let liabilities = JSON.parse(localStorage.getItem('pocketflow_liabilities')) || [];
        let subscriptions = JSON.parse(localStorage.getItem('pocketflow_subscriptions')) || [];

        let selectedSubscriptionType = 'streaming';
        let selectedSubscriptionIcon = '';
        let selectedBillingCycle = 'monthly';
        let editingSubscriptionId = null;
        let empireMode = 'asset'; // 'asset' or 'liability'
        let selectedEmpireType = 'cash';
        let selectedEmpireIcon = '';
        let editingEmpireId = null;

        // Asset types
        const assetTypes = [
            { id: 'cash', name: 'Cash & Checking', icon: '' },
            { id: 'savings', name: 'Savings', icon: '' },
            { id: 'investments', name: 'Investments', icon: '' },
            { id: 'realestate', name: 'Real Estate', icon: '' },
            { id: 'vehicles', name: 'Vehicles', icon: '' },
            { id: 'equipment', name: 'Equipment', icon: '' },
            { id: 'valuables', name: 'Valuables', icon: '' },
            { id: 'crypto', name: 'Crypto', icon: '' },
            { id: 'other', name: 'Other', icon: '' }
        ];

        // Liability types
        const liabilityTypes = [
            { id: 'creditcard', name: 'Credit Cards', icon: '' },
            { id: 'autoloan', name: 'Auto Loans', icon: '' },
            { id: 'studentloan', name: 'Student Loans', icon: '' },
            { id: 'mortgage', name: 'Mortgage', icon: '' },
            { id: 'personal', name: 'Personal Loans', icon: '' },
            { id: 'medical', name: 'Medical Debt', icon: '' },
            { id: 'taxes', name: 'Tax Owed', icon: '' },
            { id: 'business', name: 'Business Debt', icon: '' },
            { id: 'other', name: 'Other', icon: '' }
        ];

        // Initialize
        function init() {
            // Initialize onboarding event listeners
            initOnboarding();

            // Apply saved theme - default to dark mode
            if (isDarkMode) {
                document.body.classList.add('theme-dark');
                localStorage.setItem('pocketflow_darkmode', 'true');
            } else if (currentTheme) {
                document.body.classList.add(currentTheme);
            }
            
            // Update dark mode buttons
            updateDarkModeButtons();
            
            // Set greeting based on time
            updateGreeting();
            
            renderCategories();
            renderCategoriesOverview();
            updateDisplay();
            renderTransactions();
            renderChart();
            renderInsights();
            updateBudgetProgress();
            setCurrentDate();
            setupEventListeners();
            initEmojiPicker();
            renderCategoryList();
            updateCurrencyDisplay();
            
            // Debt Crusher init
            renderDebtList();
            updateDebtStats();
            initDebtTypeSelector();
            processAutoPayments(); // Process any pending auto payments

            // Wealth Builder init
            renderGoalsList();
            updateGoalsStats();
            initGoalTypeSelector();
            processAutoSavings(); // Process any pending auto savings

            // Empire init
            renderEmpireLists();
            updateEmpireStats();

            // Recurring subscriptions init
            renderSubscriptionsList();
            updateSubscriptionTotals();

            // Financial Health Score init
            calculateHealthScore();
        }

        // ==================
        // ONBOARDING SLIDESHOW
        // ==================
        let currentSlide = 0;
        const totalSlides = 5;
        
        function initOnboarding() {
            const onboarding = document.getElementById('onboarding');
            const btnNext = document.getElementById('btnNext');
            const btnSkip = document.getElementById('btnSkip');
            const dots = document.querySelectorAll('.dot');
            const nameInput = document.getElementById('nameInput');

            function showSlide(index) {
                // Update slides
                document.querySelectorAll('.slide').forEach((slide, i) => {
                    slide.classList.remove('active', 'exit');
                    if (i === index) {
                        slide.classList.add('active');
                    } else if (i < index) {
                        slide.classList.add('exit');
                    }
                });

                // Update dots
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });

                // Update button
                if (index === totalSlides - 1) {
                    btnNext.textContent = "Let's Go! ";
                    btnNext.classList.add('finish');
                    btnSkip.style.display = 'none';
                } else {
                    btnNext.textContent = 'Next ';
                    btnNext.classList.remove('finish');
                    btnSkip.style.display = 'block';
                }

                currentSlide = index;
            }

            function nextSlide() {
                if (currentSlide < totalSlides - 1) {
                    showSlide(currentSlide + 1);
                } else {
                    completeOnboarding();
                }
            }

            function completeOnboarding() {
                const name = nameInput ? nameInput.value.trim() : '';
                userName = name || 'Friend';
                localStorage.setItem('pocketflow_welcomed', 'true');
                localStorage.setItem('pocketflow_username', userName);
                
                onboarding.style.opacity = '0';
                onboarding.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    onboarding.classList.add('hidden');
                    onboarding.style.opacity = '';
                }, 300);

                updateGreeting();
                showToast(`Welcome, ${userName}! Let's build your wealth! `);
            }

            // Event listeners
            if (btnNext) btnNext.addEventListener('click', nextSlide);
            if (btnSkip) btnSkip.addEventListener('click', completeOnboarding);
            dots.forEach(dot => {
                dot.addEventListener('click', () => {
                    showSlide(parseInt(dot.dataset.slide));
                });
            });

            // Store showSlide globally for replayOnboarding
            window.showOnboardingSlide = showSlide;
        }

        function replayOnboarding() {
            currentSlide = 0;
            if (window.showOnboardingSlide) {
                window.showOnboardingSlide(0);
            }
            const nameInput = document.getElementById('nameInput');
            if (nameInput) nameInput.value = '';
            
            const onboarding = document.getElementById('onboarding');
            onboarding.classList.remove('hidden');
            onboarding.style.opacity = '1';
            
            switchPage('cashflow');
        }

        // Financial Health Score functions
        function calculateHealthScore() {
            let score = 0;
            let metrics = [];
            let tips = [];

            // Get financial data
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const totalDebt = debts.reduce((sum, d) => sum + d.balance, 0);
            const totalSavings = goals.reduce((sum, g) => sum + g.saved, 0);
            const totalAssets = assets.reduce((sum, a) => sum + a.value, 0);
            const totalLiabilities = liabilities.reduce((sum, l) => sum + l.value, 0);
            const netWorth = totalAssets - totalLiabilities;
            const monthlySubscriptions = subscriptions.reduce((sum, s) => {
                return sum + (s.billingCycle === 'yearly' ? s.amount / 12 : s.amount);
            }, 0);

            // 1. Savings Rate (25 points max)
            let savingsRate = 0;
            if (income > 0) {
                savingsRate = ((income - expenses) / income) * 100;
            }
            let savingsScore = Math.min(25, Math.max(0, savingsRate * 1.25));
            let savingsStatus = savingsRate >= 20 ? 'good' : savingsRate >= 10 ? 'warning' : 'bad';
            metrics.push({
                name: 'Savings Rate',
                icon: '',
                iconClass: 'green',
                value: `${savingsRate.toFixed(0)}%`,
                status: savingsStatus,
                bar: Math.min(100, savingsRate * 5),
                description: 'Percentage of income saved'
            });
            score += savingsScore;

            if (savingsRate < 20) {
                tips.push({ icon: '', text: '<strong>Boost your savings:</strong> Try to save at least 20% of your income. Start small and increase gradually.' });
            }

            // 2. Debt-to-Income Ratio (25 points max)
            let debtRatio = 0;
            if (income > 0) {
                debtRatio = (totalDebt / (income * 12)) * 100; // Annual comparison
            }
            let debtScore = Math.max(0, 25 - (debtRatio * 0.5));
            let debtStatus = debtRatio <= 20 ? 'good' : debtRatio <= 40 ? 'warning' : 'bad';
            metrics.push({
                name: 'Debt-to-Income',
                icon: '',
                iconClass: 'red',
                value: `${debtRatio.toFixed(0)}%`,
                status: debtStatus,
                bar: Math.min(100, 100 - debtRatio),
                description: 'Total debt vs annual income'
            });
            score += debtScore;

            if (debtRatio > 20) {
                tips.push({ icon: '', text: '<strong>Reduce debt:</strong> Focus on paying off high-interest debt first using the avalanche method.' });
            }

            // 3. Emergency Fund (20 points max)
            const emergencyGoal = goals.find(g => g.type === 'emergency');
            let emergencyMonths = 0;
            if (expenses > 0 && emergencyGoal) {
                emergencyMonths = emergencyGoal.saved / (expenses || 1);
            } else if (expenses > 0 && totalSavings > 0) {
                emergencyMonths = totalSavings / expenses;
            }
            let emergencyScore = Math.min(20, emergencyMonths * 3.33);
            let emergencyStatus = emergencyMonths >= 6 ? 'good' : emergencyMonths >= 3 ? 'warning' : 'bad';
            metrics.push({
                name: 'Emergency Fund',
                icon: '',
                iconClass: 'blue',
                value: `${emergencyMonths.toFixed(1)} mo`,
                status: emergencyStatus,
                bar: Math.min(100, (emergencyMonths / 6) * 100),
                description: 'Months of expenses covered'
            });
            score += emergencyScore;

            if (emergencyMonths < 6) {
                tips.push({ icon: '', text: '<strong>Build emergency fund:</strong> Aim for 3-6 months of expenses saved for unexpected situations.' });
            }

            // 4. Budget Adherence (15 points max)
            let budgetAdherence = 100;
            if (budget > 0) {
                budgetAdherence = Math.max(0, 100 - ((expenses / budget) * 100 - 100));
            }
            let budgetScore = Math.min(15, budgetAdherence * 0.15);
            let budgetStatus = budgetAdherence >= 90 ? 'good' : budgetAdherence >= 70 ? 'warning' : 'bad';
            metrics.push({
                name: 'Budget Control',
                icon: '',
                iconClass: 'purple',
                value: `${Math.min(100, budgetAdherence).toFixed(0)}%`,
                status: budgetStatus,
                bar: Math.min(100, budgetAdherence),
                description: 'Staying within budget'
            });
            score += budgetScore;

            if (budgetAdherence < 90) {
                tips.push({ icon: '', text: '<strong>Stick to budget:</strong> Review your spending categories and identify areas to cut back.' });
            }

            // 5. Net Worth Trend (15 points max)
            let netWorthScore = 15;
            let netWorthStatus = 'good';
            if (netWorth < 0) {
                netWorthScore = 5;
                netWorthStatus = 'bad';
            } else if (netWorth < totalAssets * 0.5) {
                netWorthScore = 10;
                netWorthStatus = 'warning';
            }
            metrics.push({
                name: 'Net Worth',
                icon: '',
                iconClass: 'orange',
                value: formatCurrency(netWorth),
                status: netWorthStatus,
                bar: netWorth > 0 ? Math.min(100, (netWorth / (totalAssets || 1)) * 100) : 0,
                description: 'Assets minus liabilities'
            });
            score += netWorthScore;

            if (netWorth < 0) {
                tips.push({ icon: '', text: '<strong>Grow net worth:</strong> Focus on reducing liabilities and building assets over time.' });
            }

            // Round final score
            score = Math.round(Math.min(100, Math.max(0, score)));

            // Determine status text and color
            let statusText = '';
            let scoreColor = '';
            if (score >= 80) {
                statusText = 'Excellent! ';
                scoreColor = '#10b981';
            } else if (score >= 60) {
                statusText = 'Good Progress ';
                scoreColor = '#10b981';
            } else if (score >= 40) {
                statusText = 'Needs Work ';
                scoreColor = '#f59e0b';
            } else {
                statusText = 'Getting Started ';
                scoreColor = '#ef4444';
            }

            // Add general tips if score is low
            if (tips.length === 0) {
                tips.push({ icon: '', text: '<strong>Great job!</strong> Keep up the excellent financial habits. Consider setting new goals to continue growing.' });
            }

            // Update UI
            renderHealthScore(score, scoreColor, statusText, metrics, tips);
        }

        function renderHealthScore(score, scoreColor, statusText, metrics, tips) {
            // Update score circle
            const ring = document.getElementById('healthScoreRing');
            const value = document.getElementById('healthScoreValue');
            const status = document.getElementById('healthScoreStatus');

            ring.style.setProperty('--score', score);
            ring.style.setProperty('--score-color', scoreColor);
            value.textContent = score;
            value.style.color = scoreColor;
            status.textContent = statusText;
            status.style.color = scoreColor;

            // Render metrics
            const metricsContainer = document.getElementById('healthMetrics');
            metricsContainer.innerHTML = metrics.map(m => `
                <div class="health-metric">
                    <div class="health-metric-header">
                        <div class="health-metric-info">
                            <div class="health-metric-icon ${m.iconClass}">${m.icon}</div>
                            <div class="health-metric-name">${m.name}</div>
                        </div>
                        <div class="health-metric-value ${m.status}">${m.value}</div>
                    </div>
                    <div class="health-metric-bar">
                        <div class="health-metric-bar-fill ${m.status}" style="width: ${m.bar}%"></div>
                    </div>
                </div>
            `).join('');

            // Render tips
            const tipsContainer = document.getElementById('healthTips');
            tipsContainer.innerHTML = tips.map(t => `
                <div class="health-tip">
                    <div class="health-tip-icon">${t.icon}</div>
                    <div class="health-tip-text">${t.text}</div>
                </div>
            `).join('');
        }

        function initEmojiPicker() {
            const grid = document.getElementById('emojiGrid');
            grid.innerHTML = emojiOptions.map(emoji => 
                `<div class="emoji-option" onclick="selectEmoji('${emoji}')">${emoji}</div>`
            ).join('');
        }

        function toggleEmojiPicker() {
            const grid = document.getElementById('emojiGrid');
            grid.style.display = grid.style.display === 'none' ? 'grid' : 'none';
        }

        function selectEmoji(emoji) {
            selectedEmoji = emoji;
            document.getElementById('selectedEmoji').textContent = emoji;
            document.getElementById('emojiGrid').style.display = 'none';
        }

        function updateCurrencyDisplay() {
            document.querySelectorAll('.currency-symbol').forEach(el => {
                el.textContent = currency;
            });
            document.querySelectorAll('.currency-option').forEach(el => {
                el.classList.toggle('active', el.dataset.currency === currency);
            });
        }

        function setCurrentDate() {
            const now = new Date();
            const options = { month: 'short', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting = 'Good evening,';
            if (hour < 12) greeting = 'Good morning,';
            else if (hour < 18) greeting = 'Good afternoon,';
            
            document.getElementById('greetingText').textContent = greeting;
            document.getElementById('userName').textContent = userName;
        }

        function updateDarkModeButtons() {
            const icon = isDarkMode ? '' : '';
            document.querySelectorAll('.dark-mode-btn').forEach(btn => {
                btn.textContent = icon;
            });
        }

        function renderCategoriesOverview() {
            const container = document.getElementById('categoriesScroll');
            const expenseCategories = categories.filter(c => c.id !== 'income');
            
            // Calculate spending per category for current month
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const monthExpenses = transactions.filter(t => 
                t.type === 'expense' && new Date(t.date) >= monthStart
            );
            
            const categoryTotals = {};
            let totalExpenses = 0;
            monthExpenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
                totalExpenses += t.amount;
            });
            
            // Start with "All" category
            let html = `
                <div class="category-chip ${!searchQuery ? 'selected' : ''}" onclick="filterByCategory('all')">
                    <span class="category-chip-icon"></span>
                    <span class="category-chip-name">All</span>
                    <span class="category-chip-amount">${formatCurrency(totalExpenses)}</span>
                </div>
            `;
            
            html += expenseCategories.map(cat => `
                <div class="category-chip ${searchQuery === cat.name ? 'selected' : ''}" onclick="filterByCategory('${cat.id}')">
                    <span class="category-chip-icon">${cat.icon}</span>
                    <span class="category-chip-name">${cat.name}</span>
                    <span class="category-chip-amount">${categoryTotals[cat.id] ? formatCurrency(categoryTotals[cat.id]) : '$0'}</span>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function filterByCategory(categoryId) {
            if (categoryId === 'all') {
                document.getElementById('searchInput').value = '';
                searchQuery = '';
            } else {
                const catName = categories.find(c => c.id === categoryId)?.name || '';
                document.getElementById('searchInput').value = catName;
                searchQuery = catName;
            }
            renderTransactions();
            renderCategoriesOverview();
        }

        function renderCategories() {
            const container = document.getElementById('modalCategories');
            const expenseCategories = categories.filter(c => c.id !== 'income');
            
            container.innerHTML = expenseCategories.map(cat => `
                <div class="category-item ${cat.id === selectedCategory ? 'selected' : ''}" 
                     onclick="selectCategory('${cat.id}', this)">
                    <span class="category-icon">${cat.icon}</span>
                    <span class="category-name">${cat.name}</span>
                </div>
            `).join('');
        }

        function selectCategory(id, element) {
            selectedCategory = id;
            document.querySelectorAll('.modal-categories .category-item').forEach(el => {
                el.classList.remove('selected');
            });
            if (element) {
                element.classList.add('selected');
            }
        }

        function updateDisplay() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;

            document.getElementById('balance').textContent = formatCurrency(balance);
            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpense').textContent = formatCurrency(expense);
        }

        function formatCurrency(amount) {
            return currency + Math.abs(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function renderInsights() {
            const expenses = transactions.filter(t => t.type === 'expense');
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = expenses.reduce((sum, t) => sum + t.amount, 0);
            
            // Average daily spending (last 30 days)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const recentExpenses = expenses.filter(t => new Date(t.date) >= thirtyDaysAgo);
            const avgDaily = recentExpenses.length > 0 ? recentExpenses.reduce((sum, t) => sum + t.amount, 0) / 30 : 0;
            
            // Top spending category
            const categoryTotals = {};
            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });
            const topCat = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1])[0];
            const topCatInfo = topCat ? categories.find(c => c.id === topCat[0]) : null;
            
            // Savings rate
            const savingsRate = income > 0 ? Math.round(((income - totalExpense) / income) * 100) : 0;
            
            document.getElementById('avgDaily').textContent = formatCurrency(avgDaily);
            document.getElementById('topCategory').textContent = topCatInfo ? topCatInfo.icon : '-';
            document.getElementById('transactionCount').textContent = transactions.length;
            document.getElementById('savingsRate').textContent = Math.max(0, savingsRate) + '%';
        }

        function updateBudgetProgress() {
            const progressSection = document.getElementById('budgetProgress');
            if (budget <= 0) {
                progressSection.style.display = 'none';
                return;
            }
            
            progressSection.style.display = 'block';
            
            // Get current month expenses
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const monthExpenses = transactions
                .filter(t => t.type === 'expense' && new Date(t.date) >= monthStart)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const percentage = Math.min((monthExpenses / budget) * 100, 100);
            const remaining = budget - monthExpenses;
            
            document.getElementById('budgetProgressAmount').textContent = 
                `${formatCurrency(monthExpenses)} / ${formatCurrency(budget)}`;
            
            const fill = document.getElementById('progressFill');
            fill.style.width = percentage + '%';
            fill.classList.remove('warning', 'danger');
            if (percentage >= 90) {
                fill.classList.add('danger');
            } else if (percentage >= 70) {
                fill.classList.add('warning');
            }
        }

        function renderTransactions() {
            const container = document.getElementById('transactionList');
            const deleteHint = document.getElementById('deleteHint');
            
            // Filter by search query
            let filtered = [...transactions];
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filtered = filtered.filter(t => {
                    const cat = categories.find(c => c.id === t.category);
                    return (t.description && t.description.toLowerCase().includes(query)) ||
                           (cat && cat.name.toLowerCase().includes(query));
                });
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">${searchQuery ? '' : ''}</div>
                        <p class="empty-state-text">${searchQuery ? 'No matching transactions found.' : 'No transactions yet.<br>Add your first one!'}</p>
                    </div>
                `;
                deleteHint.style.display = 'none';
                return;
            }

            deleteHint.style.display = 'none';

            // Sort by date, newest first
            const sorted = [...filtered].sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = sorted.map((t, i) => {
                const cat = categories.find(c => c.id === t.category) || categories.find(c => c.id === 'other');
                const time = new Date(t.date).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                const dateStr = new Date(t.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const originalIndex = transactions.indexOf(t);
                const recurringBadge = t.recurring ? `<span class="recurring-badge">${t.recurringFrequency}</span>` : '';
                
                return `
                    <div class="transaction-item">
                        <div class="transaction-icon ${t.category}">${cat.icon}</div>
                        <div class="transaction-details">
                            <div class="transaction-name">${t.description || cat.name}${recurringBadge}</div>
                            <div class="transaction-category">${cat.name}  ${dateStr}</div>
                        </div>
                        <div class="transaction-right">
                            <div>
                                <div class="transaction-amount ${t.type}">${t.type === 'expense' ? '' : '+'}${formatCurrency(t.amount)}</div>
                                <div class="transaction-time">${time}</div>
                            </div>
                            <div class="transaction-actions">
                                <button class="transaction-action-btn edit" onclick="editTransaction(${originalIndex})" title="Edit"></button>
                                <button class="transaction-action-btn delete" onclick="deleteTransaction(${originalIndex})" title="Delete"></button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderChart() {
            const container = document.getElementById('chart');
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date();
            const todayDay = today.getDay();

            // Get last 7 days of expenses
            const dailyExpenses = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dayStart = new Date(date.setHours(0, 0, 0, 0));
                const dayEnd = new Date(date.setHours(23, 59, 59, 999));
                
                const dayExpense = transactions
                    .filter(t => t.type === 'expense' && new Date(t.date) >= dayStart && new Date(t.date) <= dayEnd)
                    .reduce((sum, t) => sum + t.amount, 0);
                
                dailyExpenses.push({
                    day: days[dayStart.getDay()],
                    amount: dayExpense,
                    isToday: i === 0
                });
            }

            const maxExpense = Math.max(...dailyExpenses.map(d => d.amount), 1);

            container.innerHTML = dailyExpenses.map(d => {
                const height = Math.max((d.amount / maxExpense) * 120, 8);
                return `
                    <div class="chart-bar-wrapper">
                        <div class="chart-bar ${d.isToday ? 'active' : ''}" style="height: ${height}px"></div>
                        <span class="chart-label">${d.day}</span>
                    </div>
                `;
            }).join('');
        }

        function openModal(type) {
            currentType = type;
            editingTransactionIndex = null;
            const modal = document.getElementById('transactionModal');
            const title = document.getElementById('modalTitle');
            const btn = document.getElementById('submitBtn');
            const categoryGroup = document.getElementById('categoryGroup');

            title.textContent = type === 'income' ? 'Add Income' : 'Add Expense';
            btn.textContent = 'Save';
            btn.className = `modal-save-btn ${type}`;
            categoryGroup.style.display = type === 'income' ? 'none' : 'block';

            // Reset form
            document.getElementById('amountInput').value = '';
            document.getElementById('descriptionInput').value = '';

            if (type === 'income') {
                selectedCategory = 'income';
            } else {
                selectedCategory = 'food';
                renderCategories();
            }

            modal.classList.add('active');
            document.getElementById('amountInput').focus();
        }

        function editTransaction(index) {
            const t = transactions[index];
            if (!t) return;
            
            editingTransactionIndex = index;
            currentType = t.type;
            
            const modal = document.getElementById('transactionModal');
            const title = document.getElementById('modalTitle');
            const btn = document.getElementById('submitBtn');
            const categoryGroup = document.getElementById('categoryGroup');

            title.textContent = t.type === 'income' ? 'Edit Income' : 'Edit Expense';
            btn.textContent = 'Save';
            btn.className = `modal-save-btn ${t.type}`;
            categoryGroup.style.display = t.type === 'income' ? 'none' : 'block';

            // Fill form with transaction data
            document.getElementById('amountInput').value = t.amount;
            document.getElementById('descriptionInput').value = t.description || '';
            
            if (t.type === 'income') {
                selectedCategory = 'income';
            } else {
                selectedCategory = t.category || 'food';
                renderCategories();
            }

            modal.classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            
            // Reset form fields based on modal type
            if (id === 'transactionModal') {
                document.getElementById('amountInput').value = '';
                document.getElementById('descriptionInput').value = '';
                editingTransactionIndex = null;
            } else if (id === 'debtModal') {
                document.getElementById('debtNameInput').value = '';
                document.getElementById('debtOriginalInput').value = '';
                document.getElementById('debtBalanceInput').value = '';
                document.getElementById('debtInterestInput').value = '';
                document.getElementById('debtMinPaymentInput').value = '';
                document.getElementById('debtStartDateInput').value = '';
                editingDebtId = null;
            } else if (id === 'paymentModal') {
                document.getElementById('paymentAmountInput').value = '';
                payingDebtId = null;
            } else if (id === 'goalModal') {
                document.getElementById('goalNameInput').value = '';
                document.getElementById('goalTargetInput').value = '';
                document.getElementById('goalSavedInput').value = '';
                document.getElementById('goalDueDateInput').value = '';
                document.getElementById('goalAutoAmountInput').value = '';
                editingGoalId = null;
            } else if (id === 'depositModal') {
                document.getElementById('depositAmountInput').value = '';
                depositingGoalId = null;
            } else if (id === 'empireModal') {
                document.getElementById('empireNameInput').value = '';
                document.getElementById('empireValueInput').value = '';
                document.getElementById('empireNotesInput').value = '';
                editingEmpireId = null;
            } else if (id === 'subscriptionModal') {
                document.getElementById('subscriptionNameInput').value = '';
                document.getElementById('subscriptionAmountInput').value = '';
                document.getElementById('subscriptionBillDateInput').value = '';
                editingSubscriptionId = null;
            }
        }

        function addTransaction() {
            const amount = parseFloat(document.getElementById('amountInput').value);
            const description = document.getElementById('descriptionInput').value.trim();

            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount');
                return;
            }

            if (editingTransactionIndex !== null) {
                // Update existing transaction
                transactions[editingTransactionIndex] = {
                    ...transactions[editingTransactionIndex],
                    type: currentType,
                    amount: amount,
                    description: description,
                    category: selectedCategory,
                    recurring: isRecurring,
                    recurringFrequency: isRecurring ? recurringFrequency : null
                };
                showToast('Transaction updated!');
            } else {
                // Add new transaction
                const transaction = {
                    id: Date.now(),
                    type: currentType,
                    amount: amount,
                    description: description,
                    category: selectedCategory,
                    date: new Date().toISOString(),
                    recurring: isRecurring,
                    recurringFrequency: isRecurring ? recurringFrequency : null
                };
                transactions.push(transaction);
                showToast(currentType === 'income' ? 'Income added!' : 'Expense added!');
            }

            saveData();
            updateDisplay();
            renderTransactions();
            renderCategoriesOverview();
            closeModal('transactionModal');
            
            // Reset recurring toggle
            isRecurring = false;
            document.getElementById('recurringToggle').classList.remove('active');
            document.getElementById('frequencySelector').classList.remove('show');
        }

        function toggleRecurring() {
            isRecurring = !isRecurring;
            document.getElementById('recurringToggle').classList.toggle('active', isRecurring);
            document.getElementById('frequencySelector').classList.toggle('show', isRecurring);
        }

        function deleteTransaction(index) {
            if (confirm('Delete this transaction?')) {
                transactions.splice(index, 1);
                saveData();
                updateDisplay();
                renderTransactions();
                renderChart();
                renderInsights();
                updateBudgetProgress();
                renderCategoriesOverview();
                showToast('Transaction deleted');
            }
        }

        function openSettings() {
            document.getElementById('budgetInput').value = budget || '';
            updateCurrencyDisplay();
            renderCategoryList();
            
            // Update dark mode toggle
            document.getElementById('darkModeToggle').classList.toggle('active', isDarkMode);
            
            // Update theme picker
            document.querySelectorAll('.theme-option').forEach(el => {
                el.classList.toggle('active', el.dataset.theme === currentTheme);
            });
            
            document.getElementById('settingsModal').classList.add('active');
        }

        function switchSettingsTab(tab) {
            document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));
            
            document.querySelector(`.settings-tab[onclick*="${tab}"]`).classList.add('active');
            document.getElementById(`panel-${tab}`).classList.add('active');
        }

        function saveSettings() {
            budget = parseFloat(document.getElementById('budgetInput').value) || 0;
            localStorage.setItem('pocketflow_budget', budget);
            localStorage.setItem('pocketflow_currency', currency);
            localStorage.setItem('pocketflow_currency_code', currencyCode);
            
            updateDisplay();
            updateBudgetProgress();
            updateCurrencyDisplay();
            closeModal('settingsModal');
            showToast('Settings saved!');
        }

        function saveTheme() {
            localStorage.setItem('pocketflow_theme', currentTheme);
            localStorage.setItem('pocketflow_darkmode', isDarkMode);
            closeModal('settingsModal');
            showToast(isDarkMode ? 'Dark mode enabled!' : 'Theme applied!');
        }

        function saveAllSettings() {
            // Save user name
            userName = document.getElementById('userNameInput').value.trim() || 'Friend';
            localStorage.setItem('pocketflow_username', userName);
            
            // Save budget
            budget = parseFloat(document.getElementById('settingsBudgetInput').value) || 0;
            localStorage.setItem('pocketflow_budget', budget);
            
            // Save currency
            localStorage.setItem('pocketflow_currency', currency);
            localStorage.setItem('pocketflow_currency_code', currencyCode);
            
            // Save theme
            localStorage.setItem('pocketflow_theme', currentTheme);
            localStorage.setItem('pocketflow_darkmode', isDarkMode);
            
            // Update UI
            updateGreeting();
            updateDisplay();
            updateCurrencyDisplay();
            
            showToast('Settings saved!');
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            
            // Remove all theme classes
            document.body.classList.remove('theme-ocean', 'theme-sunset', 'theme-lavender', 'theme-rose', 'theme-forest', 'theme-dark');
            
            if (isDarkMode) {
                document.body.classList.add('theme-dark');
                // Deselect color themes in settings
                document.querySelectorAll('.theme-option').forEach(el => el.classList.remove('active'));
            } else {
                // Re-apply saved theme when turning off dark mode
                if (currentTheme) {
                    document.body.classList.add(currentTheme);
                }
                // Update theme picker to show selected theme
                document.querySelectorAll('#page-settings .theme-option').forEach(el => {
                    el.classList.toggle('active', el.dataset.theme === currentTheme);
                });
            }
            
            // Update all dark mode buttons
            updateDarkModeButtons();
            
            localStorage.setItem('pocketflow_darkmode', isDarkMode);
            showToast(isDarkMode ? 'Dark mode on' : 'Dark mode off');
        }

        function addCustomCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (!name) {
                showToast('Please enter a category name');
                return;
            }
            
            const id = 'custom_' + Date.now();
            categories.push({
                id: id,
                name: name,
                icon: selectedEmoji,
                isDefault: false
            });
            
            localStorage.setItem('pocketflow_categories', JSON.stringify(categories));
            document.getElementById('newCategoryName').value = '';
            selectedEmoji = '';
            document.getElementById('selectedEmoji').textContent = '';
            renderCategoryList();
            showToast('Category added!');
        }

        function deleteCategory(id) {
            if (confirm('Delete this category?')) {
                categories = categories.filter(c => c.id !== id);
                localStorage.setItem('pocketflow_categories', JSON.stringify(categories));
                renderCategoryList();
                showToast('Category deleted');
            }
        }

        function renderCategoryList() {
            const container = document.getElementById('categoryList');
            container.innerHTML = categories.map(cat => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-primary); border-radius: var(--radius-sm); margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 20px;">${cat.icon}</span>
                        <span style="font-weight: 500;">${cat.name}</span>
                    </div>
                    ${!cat.isDefault ? `<button onclick="deleteCategory('${cat.id}')" style="background: none; border: none; color: var(--accent-red); cursor: pointer; font-size: 18px;"></button>` : '<span style="font-size: 11px; color: var(--text-muted);">Default</span>'}
                </div>
            `).join('');
        }

        function exportData() {
            const data = {
                transactions: transactions,
                categories: categories,
                budget: budget,
                currency: currency,
                currencyCode: currencyCode,
                theme: currentTheme,
                darkMode: isDarkMode,
                debts: debts,
                debtStrategy: debtStrategy,
                goals: goals,
                assets: assets,
                liabilities: liabilities,
                subscriptions: subscriptions,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cashflow-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Data exported!');
        }

        function exportCSV() {
            const headers = ['Date', 'Type', 'Category', 'Description', 'Amount'];
            const rows = transactions.map(t => {
                const cat = categories.find(c => c.id === t.category);
                return [
                    new Date(t.date).toLocaleDateString(),
                    t.type,
                    cat ? cat.name : t.category,
                    t.description || '',
                    t.amount.toFixed(2)
                ].join(',');
            });
            
            const csv = [headers.join(','), ...rows].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cashflow-transactions-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('CSV exported!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.transactions) transactions = data.transactions;
                    if (data.categories) categories = data.categories;
                    if (data.budget) budget = data.budget;
                    if (data.currency) currency = data.currency;
                    if (data.currencyCode) currencyCode = data.currencyCode;
                    if (data.debts) debts = data.debts;
                    if (data.debtStrategy) debtStrategy = data.debtStrategy;
                    if (data.goals) goals = data.goals;
                    if (data.assets) assets = data.assets;
                    if (data.liabilities) liabilities = data.liabilities;
                    if (data.subscriptions) subscriptions = data.subscriptions;
                    if (data.darkMode !== undefined) {
                        isDarkMode = data.darkMode;
                        localStorage.setItem('pocketflow_darkmode', isDarkMode);
                    }
                    if (data.theme !== undefined) {
                        currentTheme = data.theme;
                    }
                    
                    // Apply theme
                    document.body.classList.remove('theme-ocean', 'theme-sunset', 'theme-lavender', 'theme-rose', 'theme-forest', 'theme-dark');
                    if (isDarkMode) {
                        document.body.classList.add('theme-dark');
                    } else if (currentTheme) {
                        document.body.classList.add(currentTheme);
                    }
                    
                    saveData();
                    saveDebts();
                    saveGoals();
                    saveAssets();
                    saveLiabilities();
                    saveSubscriptions();
                    localStorage.setItem('pocketflow_categories', JSON.stringify(categories));
                    localStorage.setItem('pocketflow_budget', budget);
                    localStorage.setItem('pocketflow_currency', currency);
                    localStorage.setItem('pocketflow_currency_code', currencyCode);
                    localStorage.setItem('pocketflow_theme', currentTheme);
                    localStorage.setItem('pocketflow_debt_strategy', debtStrategy);
                    
                    updateDisplay();
                    renderTransactions();
                    renderChart();
                    renderInsights();
                    updateBudgetProgress();
                    updateCurrencyDisplay();
                    renderDebtList();
                    updateDebtStats();
                    renderGoalsList();
                    updateGoalsStats();
                    renderEmpireLists();
                    updateEmpireStats();
                    renderSubscriptionsList();
                    updateSubscriptionTotals();
                    
                    closeModal('settingsModal');
                    showToast('Data imported successfully!');
                } catch (err) {
                    showToast('Error importing data');
                }
            };
            reader.readAsText(file);
        }

        function saveBudget() {
            budget = parseFloat(document.getElementById('budgetInput').value) || 0;
            localStorage.setItem('pocketflow_budget', budget);
            updateBudgetProgress();
            closeModal('settingsModal');
            showToast('Budget saved!');
        }

        function resetData() {
            if (confirm('Are you sure you want to delete all data? This cannot be undone.')) {
                transactions = [];
                budget = 0;
                categories = [...defaultCategories];
                currency = '$';
                currencyCode = 'USD';
                currentTheme = '';
                isDarkMode = false;
                userName = 'Friend';
                debts = [];
                debtStrategy = 'avalanche';
                goals = [];
                assets = [];
                liabilities = [];
                subscriptions = [];
                
                localStorage.removeItem('pocketflow_transactions');
                localStorage.removeItem('pocketflow_budget');
                localStorage.removeItem('pocketflow_categories');
                localStorage.removeItem('pocketflow_currency');
                localStorage.removeItem('pocketflow_currency_code');
                localStorage.removeItem('pocketflow_theme');
                localStorage.removeItem('pocketflow_darkmode');
                localStorage.removeItem('pocketflow_username');
                localStorage.removeItem('pocketflow_debts');
                localStorage.removeItem('pocketflow_debt_strategy');
                localStorage.removeItem('pocketflow_goals');
                localStorage.removeItem('pocketflow_assets');
                localStorage.removeItem('pocketflow_liabilities');
                localStorage.removeItem('pocketflow_subscriptions');
                
                document.body.className = '';
                updateDarkModeButtons();
                updateGreeting();
                updateDisplay();
                renderTransactions();
                renderCategoriesOverview();
                updateCurrencyDisplay();
                renderDebtList();
                updateDebtStats();
                renderGoalsList();
                updateGoalsStats();
                renderEmpireLists();
                updateEmpireStats();
                renderSubscriptionsList();
                updateSubscriptionTotals();
                calculateHealthScore();
                showToast('All data cleared');
            }
        }

        function saveData() {
            localStorage.setItem('pocketflow_transactions', JSON.stringify(transactions));
        }

        function toggleFilter() {
            // Simple filter toggle - could expand to category filter
            showToast('Filter coming soon!');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        function setupEventListeners() {
            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });

            // Period selector
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Enter key to submit
            document.getElementById('amountInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('descriptionInput').focus();
                }
            });

            document.getElementById('descriptionInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTransaction();
                }
            });

            // Search input
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchQuery = e.target.value;
                renderTransactions();
            });

            // Currency selector
            document.querySelectorAll('.currency-option').forEach(opt => {
                opt.addEventListener('click', (e) => {
                    e.stopPropagation();
                    currency = opt.dataset.currency;
                    currencyCode = opt.dataset.code;
                    document.querySelectorAll('.currency-option').forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');
                    updateCurrencyDisplay();
                });
            });

            // Theme selector
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Only allow theme selection if dark mode is off
                    if (isDarkMode) {
                        showToast('Turn off dark mode to use color themes');
                        return;
                    }
                    
                    document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');
                    currentTheme = opt.dataset.theme;
                    document.body.classList.remove('theme-ocean', 'theme-sunset', 'theme-lavender', 'theme-rose', 'theme-forest');
                    if (currentTheme) {
                        document.body.classList.add(currentTheme);
                    }
                });
            });

            // Frequency selector
            document.querySelectorAll('.frequency-option').forEach(opt => {
                opt.addEventListener('click', (e) => {
                    e.stopPropagation();
                    document.querySelectorAll('.frequency-option').forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');
                    recurringFrequency = opt.dataset.freq;
                });
            });

            // Click outside modal to close
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });
        }

        // =====================
        // DEBT CRUSHER FUNCTIONS
        // =====================

        function switchPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`page-${page}`).classList.add('active');
            document.querySelector(`.nav-item[onclick*="${page}"]`).classList.add('active');
            
            if (page === 'cashflow') {
                renderCategoriesOverview();
            } else if (page === 'debt') {
                renderDebtList();
                updateDebtStats();
            } else if (page === 'wealth') {
                renderGoalsList();
                updateGoalsStats();
            } else if (page === 'empire') {
                renderEmpireLists();
                updateEmpireStats();
            } else if (page === 'recurring') {
                renderSubscriptionsList();
                updateSubscriptionTotals();
            } else if (page === 'health') {
                updateHealthScore();
            } else if (page === 'settings') {
                // Populate settings fields
                document.getElementById('userNameInput').value = userName;
                document.getElementById('settingsBudgetInput').value = budget || '';
                updateCurrencyDisplay();
                renderCategoryList();
                initEmojiPicker();
                initSettingsThemePicker();
            }
        }

        function initSettingsThemePicker() {
            const themeOptions = document.querySelectorAll('#page-settings .theme-option');
            
            // Update active state
            themeOptions.forEach(el => {
                el.classList.toggle('active', el.dataset.theme === currentTheme && !isDarkMode);
            });
            
            // Add click handlers
            themeOptions.forEach(opt => {
                // Remove old listeners by cloning
                const newOpt = opt.cloneNode(true);
                opt.parentNode.replaceChild(newOpt, opt);
                
                newOpt.addEventListener('click', () => {
                    if (isDarkMode) {
                        showToast('Turn off dark mode first');
                        return;
                    }
                    
                    // Update UI
                    document.querySelectorAll('#page-settings .theme-option').forEach(o => o.classList.remove('active'));
                    newOpt.classList.add('active');
                    
                    // Apply theme
                    currentTheme = newOpt.dataset.theme;
                    document.body.classList.remove('theme-ocean', 'theme-sunset', 'theme-lavender', 'theme-rose', 'theme-forest', 'theme-dark');
                    if (currentTheme) {
                        document.body.classList.add(currentTheme);
                    }
                    
                    // Save
                    localStorage.setItem('pocketflow_theme', currentTheme);
                    showToast('Theme applied!');
                });
            });
        }

        function initDebtTypeSelector() {
            // Set default start date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('debtStartDateInput').value = today;
        }

        function selectDebtType(element, type, icon) {
            document.querySelectorAll('.debt-type-item').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            selectedDebtType = type;
            selectedDebtIcon = icon;
        }

        function selectDebtSchedule(element, schedule) {
            document.querySelectorAll('#debtModal .schedule-option').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            selectedSchedule = schedule;
        }

        function selectGoalType(element, type, icon) {
            document.querySelectorAll('.goal-type-item').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            selectedGoalType = type;
            selectedGoalIcon = icon;
        }

        function selectGoalSchedule(element, schedule) {
            document.querySelectorAll('#goalModal .schedule-option').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            selectedGoalSchedule = schedule;
            
            // Show/hide auto amount input
            const autoAmountGroup = document.getElementById('goalAutoAmountGroup');
            if (autoAmountGroup) {
                autoAmountGroup.style.display = schedule === 'none' ? 'none' : 'block';
            }
        }

        function selectCurrency(element, curr, code) {
            currency = curr;
            currencyCode = code;
            document.querySelectorAll('.currency-option').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            updateCurrencyDisplay();
        }

        function selectTheme(element, theme) {
            if (isDarkMode) {
                showToast('Turn off dark mode first');
                return;
            }
            
            document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            currentTheme = theme;
            document.body.classList.remove('theme-ocean', 'theme-sunset', 'theme-lavender', 'theme-rose', 'theme-forest');
            if (currentTheme) {
                document.body.classList.add(currentTheme);
            }
            localStorage.setItem('pocketflow_theme', currentTheme);
            showToast('Theme applied!');
        }

        function openDebtModal(debtId = null) {
            editingDebtId = debtId;
            const modal = document.getElementById('debtModal');
            const title = document.getElementById('debtModalTitle');
            const btn = document.getElementById('debtSubmitBtn');
            const deleteBtn = document.getElementById('debtDeleteBtn');
            const today = new Date().toISOString().split('T')[0];
            
            if (debtId) {
                const debt = debts.find(d => d.id === debtId);
                if (debt) {
                    title.textContent = 'Edit Debt';
                    btn.textContent = 'Save Changes';
                    deleteBtn.style.display = 'block';
                    document.getElementById('debtNameInput').value = debt.name;
                    document.getElementById('debtOriginalInput').value = debt.original;
                    document.getElementById('debtBalanceInput').value = debt.balance;
                    document.getElementById('debtInterestInput').value = debt.interest || '';
                    document.getElementById('debtMinPaymentInput').value = debt.minPayment || '';
                    document.getElementById('debtStartDateInput').value = debt.startDate || today;
                    
                    // Select the right type
                    selectedDebtType = debt.type;
                    selectedDebtIcon = debt.icon;
                    document.querySelectorAll('.debt-type-item').forEach(o => {
                        o.classList.toggle('active', o.dataset.type === debt.type);
                    });

                    // Select schedule
                    selectedSchedule = debt.schedule || 'weekly';
                    document.querySelectorAll('#debtModal .schedule-option').forEach(o => {
                        o.classList.toggle('active', o.dataset.schedule === selectedSchedule);
                    });
                }
            } else {
                title.textContent = 'Add Debt';
                btn.textContent = 'Add Debt';
                deleteBtn.style.display = 'none';
                document.getElementById('debtNameInput').value = '';
                document.getElementById('debtOriginalInput').value = '';
                document.getElementById('debtBalanceInput').value = '';
                document.getElementById('debtInterestInput').value = '';
                document.getElementById('debtMinPaymentInput').value = '';
                document.getElementById('debtStartDateInput').value = today;
                
                // Reset to defaults
                selectedDebtType = 'credit';
                selectedDebtIcon = '';
                selectedSchedule = 'weekly';
                document.querySelectorAll('.debt-type-item').forEach(o => {
                    o.classList.toggle('active', o.dataset.type === 'credit');
                });
                document.querySelectorAll('#debtModal .schedule-option').forEach(o => {
                    o.classList.toggle('active', o.dataset.schedule === 'weekly');
                });
            }
            
            modal.classList.add('active');
        }

        function deleteCurrentDebt() {
            if (editingDebtId && confirm('Delete this debt?')) {
                debts = debts.filter(d => d.id !== editingDebtId);
                saveDebts();
                renderDebtList();
                updateDebtStats();
                closeModal('debtModal');
                editingDebtId = null;
                showToast('Debt removed');
            }
        }

        function addDebt() {
            const name = document.getElementById('debtNameInput').value.trim();
            const original = parseFloat(document.getElementById('debtOriginalInput').value);
            const balanceInput = document.getElementById('debtBalanceInput').value;
            const balance = balanceInput === '' ? original : parseFloat(balanceInput);
            const interest = parseFloat(document.getElementById('debtInterestInput').value) || 0;
            const minPayment = parseFloat(document.getElementById('debtMinPaymentInput').value) || 0;
            const startDate = document.getElementById('debtStartDateInput').value;

            if (!name) {
                showToast('Please enter an account name');
                return;
            }
            if (!original || original <= 0) {
                showToast('Please enter the original amount');
                return;
            }
            if (isNaN(balance) || balance < 0) {
                showToast('Please enter a valid balance');
                return;
            }

            if (editingDebtId) {
                // Update existing debt
                const index = debts.findIndex(d => d.id === editingDebtId);
                if (index !== -1) {
                    debts[index] = {
                        ...debts[index],
                        name,
                        original,
                        balance,
                        interest,
                        minPayment,
                        type: selectedDebtType,
                        icon: selectedDebtIcon,
                        schedule: selectedSchedule,
                        startDate: startDate
                    };
                }
                showToast('Debt updated!');
            } else {
                // Add new debt
                const debt = {
                    id: Date.now(),
                    name,
                    original,
                    balance,
                    interest,
                    minPayment,
                    type: selectedDebtType,
                    icon: selectedDebtIcon,
                    schedule: selectedSchedule,
                    startDate: startDate,
                    lastAutoPayment: null,
                    payments: [],
                    createdAt: new Date().toISOString()
                };
                debts.push(debt);
                showToast('Debt added! Let\'s crush it! ');
            }

            saveDebts();
            renderDebtList();
            updateDebtStats();
            processAutoPayments(); // Check if any auto payments are due
            closeModal('debtModal');
            editingDebtId = null;
        }

        function processAutoPayments() {
            const now = new Date();
            let paymentsProcessed = 0;

            debts.forEach(debt => {
                if (debt.schedule === 'none' || debt.balance <= 0 || !debt.minPayment) return;

                const startDate = new Date(debt.startDate);
                const lastPayment = debt.lastAutoPayment ? new Date(debt.lastAutoPayment) : null;
                
                let intervalDays;
                switch (debt.schedule) {
                    case 'weekly': intervalDays = 7; break;
                    case 'biweekly': intervalDays = 14; break;
                    case 'monthly': intervalDays = 30; break;
                    default: return;
                }

                // Calculate next payment date
                let nextPaymentDate;
                if (lastPayment) {
                    nextPaymentDate = new Date(lastPayment);
                    nextPaymentDate.setDate(nextPaymentDate.getDate() + intervalDays);
                } else {
                    nextPaymentDate = startDate;
                }

                // Process all due payments
                while (nextPaymentDate <= now && debt.balance > 0) {
                    const paymentAmount = Math.min(debt.minPayment, debt.balance);
                    debt.balance = Math.max(0, debt.balance - paymentAmount);
                    debt.payments = debt.payments || [];
                    debt.payments.push({
                        amount: paymentAmount,
                        date: nextPaymentDate.toISOString(),
                        auto: true
                    });
                    debt.lastAutoPayment = nextPaymentDate.toISOString();
                    paymentsProcessed++;
                    
                    // Move to next payment date
                    nextPaymentDate.setDate(nextPaymentDate.getDate() + intervalDays);
                }
            });

            if (paymentsProcessed > 0) {
                saveDebts();
                showToast(`${paymentsProcessed} auto-payment(s) processed! `);
            }
        }

        function getNextPaymentDate(debt) {
            if (debt.schedule === 'none' || debt.balance <= 0) return null;

            const lastPayment = debt.lastAutoPayment ? new Date(debt.lastAutoPayment) : new Date(debt.startDate);
            let intervalDays;
            switch (debt.schedule) {
                case 'weekly': intervalDays = 7; break;
                case 'biweekly': intervalDays = 14; break;
                case 'monthly': intervalDays = 30; break;
                default: return null;
            }

            const nextDate = new Date(lastPayment);
            nextDate.setDate(nextDate.getDate() + intervalDays);
            return nextDate;
        }

        function openPaymentModal(debtId) {
            payingDebtId = debtId;
            const debt = debts.find(d => d.id === debtId);
            if (!debt) return;
            
            document.getElementById('paymentDebtName').textContent = `${debt.icon} ${debt.name}`;
            document.getElementById('paymentAmountInput').value = debt.minPayment || '';
            document.getElementById('paymentModal').classList.add('active');
        }

        function makePayment() {
            const amount = parseFloat(document.getElementById('paymentAmountInput').value);
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount');
                return;
            }

            const debtIndex = debts.findIndex(d => d.id === payingDebtId);
            if (debtIndex === -1) return;

            const debt = debts[debtIndex];
            const previousBalance = debt.balance;
            debt.balance = Math.max(0, debt.balance - amount);
            debt.payments = debt.payments || [];
            debt.payments.push({
                amount,
                date: new Date().toISOString()
            });

            saveDebts();
            renderDebtList();
            updateDebtStats();
            closeModal('paymentModal');

            // Check if debt was just paid off
            if (previousBalance > 0 && debt.balance === 0) {
                showCelebration(debt.name);
            } else {
                showToast(`Payment of ${formatCurrency(amount)} recorded! `);
            }

            payingDebtId = null;
        }

        function deleteDebt(debtId) {
            if (confirm('Delete this debt?')) {
                debts = debts.filter(d => d.id !== debtId);
                saveDebts();
                renderDebtList();
                updateDebtStats();
                showToast('Debt removed');
            }
        }

        function selectStrategy(strategy) {
            debtStrategy = strategy;
            localStorage.setItem('pocketflow_debt_strategy', strategy);
            document.querySelectorAll('.strategy-pill').forEach(c => {
                c.classList.toggle('active', c.dataset.strategy === strategy);
            });
            renderDebtList();
        }

        function renderDebtList() {
            const container = document.getElementById('debtList');
            const emptyState = document.getElementById('debtEmptyState');
            const listContainer = document.getElementById('debtListContainer');
            const quickStats = document.getElementById('quickStatsBar');
            const strategyPills = document.getElementById('strategyPills');
            
            if (debts.length === 0) {
                emptyState.style.display = 'flex';
                listContainer.style.display = 'none';
                quickStats.style.display = 'none';
                strategyPills.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            listContainer.style.display = 'block';
            quickStats.style.display = 'flex';
            strategyPills.style.display = 'flex';

            // Sort based on strategy
            const sortedDebts = [...debts].sort((a, b) => {
                if (debtStrategy === 'avalanche') {
                    return (b.interest || 0) - (a.interest || 0);
                } else {
                    return a.balance - b.balance;
                }
            });

            container.innerHTML = sortedDebts.map((debt, index) => {
                const paid = debt.original - debt.balance;
                const progress = debt.original > 0 ? (paid / debt.original) * 100 : 0;
                const isPaidOff = debt.balance === 0;
                const nextPayment = getNextPaymentDate(debt);
                const scheduleLabels = { weekly: 'Weekly', biweekly: 'Bi-weekly', monthly: 'Monthly', none: 'Manual' };
                
                let nextPaymentHtml = '';
                if (debt.schedule !== 'none' && debt.balance > 0 && nextPayment) {
                    const daysUntil = Math.ceil((nextPayment - new Date()) / (1000 * 60 * 60 * 24));
                    const dateStr = nextPayment.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    nextPaymentHtml = `
                        <div class="next-payment-info">
                            <span class="next-payment-info-icon"></span>
                            <span>Next auto-payment: ${formatCurrency(debt.minPayment)} on ${dateStr} (${daysUntil} days)</span>
                        </div>
                    `;
                }

                return `
                    <div class="debt-card ${isPaidOff ? 'paid-off' : ''}">
                        <div class="debt-card-header">
                            <div class="debt-card-info">
                                <div class="debt-card-icon">${debt.icon}</div>
                                <div>
                                    <div class="debt-card-name">
                                        ${debt.name}
                                        ${isPaidOff ? '<span style="color: #22c55e; margin-left: 6px;"> Paid</span>' : ''}
                                        ${debt.schedule !== 'none' && !isPaidOff ? `<span class="auto-pay-badge"> ${scheduleLabels[debt.schedule]}</span>` : ''}
                                    </div>
                                    <div class="debt-card-type">${debt.interest ? debt.interest + '% APR' : 'No interest'}</div>
                                </div>
                            </div>
                            <div class="debt-card-balance">
                                <div class="debt-card-balance-label">Balance</div>
                                <div class="debt-card-balance-value">${formatCurrency(debt.balance)}</div>
                            </div>
                        </div>
                        <div class="debt-card-progress">
                            <div class="debt-progress-info">
                                <span class="debt-progress-paid">${formatCurrency(paid)} paid</span>
                                <span class="debt-progress-percent">${Math.round(progress)}%</span>
                            </div>
                            <div class="debt-progress-track">
                                <div class="debt-progress-bar" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        ${nextPaymentHtml}
                        <div class="debt-card-footer">
                            <button class="debt-action-btn secondary" onclick="openDebtModal(${debt.id})"> Edit</button>
                            ${!isPaidOff ? `<button class="debt-action-btn primary" onclick="openPaymentModal(${debt.id})"> Pay Now</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateDebtStats() {
            const totalDebt = debts.reduce((sum, d) => sum + d.balance, 0);
            const totalOriginal = debts.reduce((sum, d) => sum + d.original, 0);
            const totalPaid = totalOriginal - totalDebt;
            const paidOff = debts.filter(d => d.balance === 0).length;
            const avgProgress = totalOriginal > 0 ? (totalPaid / totalOriginal) * 100 : 0;

            document.getElementById('totalDebt').textContent = formatCurrency(totalDebt);
            document.getElementById('debtsPaidOff').textContent = paidOff;
            document.getElementById('totalPaidAmount').textContent = formatCurrency(totalPaid);
            document.getElementById('avgProgress').textContent = Math.round(avgProgress) + '%';

            // Calculate debt-free date estimate
            const monthlyPayment = debts.reduce((sum, d) => sum + (d.minPayment || 0), 0);
            if (monthlyPayment > 0 && totalDebt > 0) {
                const monthsToPayoff = Math.ceil(totalDebt / monthlyPayment);
                const freeDate = new Date();
                freeDate.setMonth(freeDate.getMonth() + monthsToPayoff);
                document.getElementById('debtFreeDate').textContent = 
                    'Free by ' + freeDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            } else if (totalDebt === 0 && debts.length > 0) {
                document.getElementById('debtFreeDate').textContent = ' DEBT FREE!';
            } else {
                document.getElementById('debtFreeDate').textContent = 'Add debts to start';
            }

            // Find next auto payment
            const upcomingPayments = debts
                .filter(d => d.schedule !== 'none' && d.balance > 0)
                .map(d => ({ debt: d, date: getNextPaymentDate(d) }))
                .filter(p => p.date)
                .sort((a, b) => a.date - b.date);

            if (upcomingPayments.length > 0) {
                const next = upcomingPayments[0];
                const daysUntil = Math.ceil((next.date - new Date()) / (1000 * 60 * 60 * 24));
                document.getElementById('nextAutoPayment').textContent = 
                    daysUntil <= 0 ? 'Today!' : `${daysUntil}d`;
            } else {
                document.getElementById('nextAutoPayment').textContent = '-';
            }
        }

        function showCelebration(debtName) {
            const overlay = document.getElementById('celebrationOverlay');
            document.getElementById('celebrationText').textContent = `You completely paid off ${debtName}!`;
            overlay.classList.add('active');
            
            // Create confetti
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.background = ['#ff6b9d', '#22c55e', '#3b82f6', '#fbbf24', '#a855f7'][Math.floor(Math.random() * 5)];
                overlay.appendChild(confetti);
            }

            // Auto close after 4 seconds
            setTimeout(closeCelebration, 4000);
        }

        function closeCelebration() {
            const overlay = document.getElementById('celebrationOverlay');
            overlay.classList.remove('active');
            // Remove confetti
            overlay.querySelectorAll('.confetti').forEach(c => c.remove());
        }

        function saveDebts() {
            localStorage.setItem('pocketflow_debts', JSON.stringify(debts));
        }

        // =====================
        // WEALTH BUILDER FUNCTIONS
        // =====================

        function initGoalTypeSelector() {
            // Goal type and schedule selectors now use onclick handlers in HTML
        }

        function openGoalModal(goalId = null) {
            editingGoalId = goalId;
            const modal = document.getElementById('goalModal');
            const title = document.getElementById('goalModalTitle');
            const btn = document.getElementById('goalSubmitBtn');
            const deleteBtn = document.getElementById('goalDeleteBtn');
            
            // Set default due date to 6 months from now
            const defaultDate = new Date();
            defaultDate.setMonth(defaultDate.getMonth() + 6);
            
            if (goalId) {
                const goal = goals.find(g => g.id === goalId);
                if (goal) {
                    title.textContent = 'Edit Goal';
                    btn.textContent = 'Save Changes';
                    deleteBtn.style.display = 'block';
                    document.getElementById('goalNameInput').value = goal.name;
                    document.getElementById('goalTargetInput').value = goal.target;
                    document.getElementById('goalSavedInput').value = goal.saved;
                    document.getElementById('goalDueDateInput').value = goal.dueDate || '';
                    document.getElementById('goalAutoAmountInput').value = goal.autoAmount || '';
                    
                    // Select the right type
                    selectedGoalType = goal.type;
                    selectedGoalIcon = goal.icon;
                    document.querySelectorAll('.goal-type-item').forEach(o => {
                        o.classList.toggle('active', o.dataset.type === goal.type);
                    });

                    // Select schedule
                    selectedGoalSchedule = goal.schedule || 'weekly';
                    document.querySelectorAll('#goalModal .schedule-option').forEach(o => {
                        o.classList.toggle('active', o.dataset.schedule === selectedGoalSchedule);
                    });
                    document.getElementById('goalAutoAmountGroup').style.display = 
                        selectedGoalSchedule === 'none' ? 'none' : 'block';
                }
            } else {
                title.textContent = 'Create Goal';
                btn.textContent = 'Create Goal';
                deleteBtn.style.display = 'none';
                document.getElementById('goalNameInput').value = '';
                document.getElementById('goalTargetInput').value = '';
                document.getElementById('goalSavedInput').value = '';
                document.getElementById('goalDueDateInput').value = defaultDate.toISOString().split('T')[0];
                document.getElementById('goalAutoAmountInput').value = '';
                
                // Reset to defaults
                selectedGoalType = 'emergency';
                selectedGoalIcon = '';
                selectedGoalSchedule = 'weekly';
                document.querySelectorAll('.goal-type-item').forEach(o => {
                    o.classList.toggle('active', o.dataset.type === 'emergency');
                });
                document.querySelectorAll('#goalModal .schedule-option').forEach(o => {
                    o.classList.toggle('active', o.dataset.schedule === 'weekly');
                });
                document.getElementById('goalAutoAmountGroup').style.display = 'block';
            }
            
            modal.classList.add('active');
        }

        function addGoal() {
            const name = document.getElementById('goalNameInput').value.trim();
            const target = parseFloat(document.getElementById('goalTargetInput').value);
            const saved = parseFloat(document.getElementById('goalSavedInput').value) || 0;
            const dueDate = document.getElementById('goalDueDateInput').value;
            const autoAmount = parseFloat(document.getElementById('goalAutoAmountInput').value) || 0;

            if (!name) {
                showToast('Please enter a goal name');
                return;
            }
            if (!target || target <= 0) {
                showToast('Please enter a target amount');
                return;
            }

            if (editingGoalId) {
                const index = goals.findIndex(g => g.id === editingGoalId);
                if (index !== -1) {
                    goals[index] = {
                        ...goals[index],
                        name,
                        target,
                        saved: Math.min(saved, target),
                        dueDate,
                        autoAmount,
                        type: selectedGoalType,
                        icon: selectedGoalIcon,
                        schedule: selectedGoalSchedule
                    };
                }
                showToast('Goal updated!');
            } else {
                const goal = {
                    id: Date.now(),
                    name,
                    target,
                    saved: Math.min(saved, target),
                    dueDate,
                    autoAmount,
                    type: selectedGoalType,
                    icon: selectedGoalIcon,
                    schedule: selectedGoalSchedule,
                    lastAutoSave: null,
                    deposits: [],
                    createdAt: new Date().toISOString()
                };
                goals.push(goal);
                showToast('Goal created! Let\'s start saving! ');
            }

            saveGoals();
            renderGoalsList();
            updateGoalsStats();
            processAutoSavings();
            closeModal('goalModal');
            editingGoalId = null;
        }

        function deleteCurrentGoal() {
            if (editingGoalId && confirm('Delete this goal?')) {
                goals = goals.filter(g => g.id !== editingGoalId);
                saveGoals();
                renderGoalsList();
                updateGoalsStats();
                closeModal('goalModal');
                editingGoalId = null;
                showToast('Goal removed');
            }
        }

        function openDepositModal(goalId) {
            depositingGoalId = goalId;
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            document.getElementById('depositGoalName').textContent = `${goal.icon} ${goal.name}`;
            document.getElementById('depositAmountInput').value = goal.autoAmount || '';
            document.getElementById('depositModal').classList.add('active');
        }

        function makeDeposit() {
            const amount = parseFloat(document.getElementById('depositAmountInput').value);
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount');
                return;
            }

            const goalIndex = goals.findIndex(g => g.id === depositingGoalId);
            if (goalIndex === -1) return;

            const goal = goals[goalIndex];
            const previousSaved = goal.saved;
            goal.saved = Math.min(goal.saved + amount, goal.target);
            goal.deposits = goal.deposits || [];
            goal.deposits.push({
                amount,
                date: new Date().toISOString()
            });

            saveGoals();
            renderGoalsList();
            updateGoalsStats();
            closeModal('depositModal');

            // Check if goal was just reached
            if (previousSaved < goal.target && goal.saved >= goal.target) {
                showGoalCelebration(goal.name);
            } else {
                showToast(`${formatCurrency(amount)} saved! Keep going! `);
            }

            depositingGoalId = null;
        }

        function processAutoSavings() {
            const now = new Date();
            let savingsProcessed = 0;

            goals.forEach(goal => {
                if (goal.schedule === 'none' || goal.saved >= goal.target || !goal.autoAmount) return;

                const createdDate = new Date(goal.createdAt);
                const lastSave = goal.lastAutoSave ? new Date(goal.lastAutoSave) : null;
                
                let intervalDays;
                switch (goal.schedule) {
                    case 'weekly': intervalDays = 7; break;
                    case 'biweekly': intervalDays = 14; break;
                    case 'monthly': intervalDays = 30; break;
                    default: return;
                }

                let nextSaveDate;
                if (lastSave) {
                    nextSaveDate = new Date(lastSave);
                    nextSaveDate.setDate(nextSaveDate.getDate() + intervalDays);
                } else {
                    nextSaveDate = createdDate;
                }

                while (nextSaveDate <= now && goal.saved < goal.target) {
                    const saveAmount = Math.min(goal.autoAmount, goal.target - goal.saved);
                    goal.saved += saveAmount;
                    goal.deposits = goal.deposits || [];
                    goal.deposits.push({
                        amount: saveAmount,
                        date: nextSaveDate.toISOString(),
                        auto: true
                    });
                    goal.lastAutoSave = nextSaveDate.toISOString();
                    savingsProcessed++;
                    
                    nextSaveDate.setDate(nextSaveDate.getDate() + intervalDays);
                }
            });

            if (savingsProcessed > 0) {
                saveGoals();
                showToast(`${savingsProcessed} auto-save(s) processed! `);
            }
        }

        function getNextSaveDate(goal) {
            if (goal.schedule === 'none' || goal.saved >= goal.target) return null;

            const lastSave = goal.lastAutoSave ? new Date(goal.lastAutoSave) : new Date(goal.createdAt);
            let intervalDays;
            switch (goal.schedule) {
                case 'weekly': intervalDays = 7; break;
                case 'biweekly': intervalDays = 14; break;
                case 'monthly': intervalDays = 30; break;
                default: return null;
            }

            const nextDate = new Date(lastSave);
            nextDate.setDate(nextDate.getDate() + intervalDays);
            return nextDate;
        }

        function renderGoalsList() {
            const container = document.getElementById('goalsList');
            const emptyState = document.getElementById('goalsEmptyState');
            const listContainer = document.getElementById('goalsListContainer');
            const quickStats = document.getElementById('goalsQuickStats');
            
            if (goals.length === 0) {
                emptyState.style.display = 'flex';
                listContainer.style.display = 'none';
                quickStats.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            listContainer.style.display = 'block';
            quickStats.style.display = 'flex';

            // Sort: incomplete first, then by progress
            const sortedGoals = [...goals].sort((a, b) => {
                const aComplete = a.saved >= a.target;
                const bComplete = b.saved >= b.target;
                if (aComplete !== bComplete) return aComplete ? 1 : -1;
                return (b.saved / b.target) - (a.saved / a.target);
            });

            container.innerHTML = sortedGoals.map(goal => {
                const progress = goal.target > 0 ? (goal.saved / goal.target) * 100 : 0;
                const isComplete = goal.saved >= goal.target;
                const remaining = Math.max(0, goal.target - goal.saved);
                const nextSave = getNextSaveDate(goal);
                const scheduleLabels = { weekly: 'Weekly', biweekly: 'Bi-weekly', monthly: 'Monthly', none: 'Manual' };
                
                // Format due date
                let dueDateStr = '';
                if (goal.dueDate) {
                    const due = new Date(goal.dueDate);
                    dueDateStr = due.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                }

                let nextSaveHtml = '';
                if (goal.schedule !== 'none' && !isComplete && nextSave) {
                    const daysUntil = Math.ceil((nextSave - new Date()) / (1000 * 60 * 60 * 24));
                    const dateStr = nextSave.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    nextSaveHtml = `
                        <div class="next-deposit-info">
                            <span></span>
                            <span>Next auto-save: ${formatCurrency(goal.autoAmount)} on ${dateStr} (${daysUntil} days)</span>
                        </div>
                    `;
                }

                return `
                    <div class="goal-card ${isComplete ? 'completed' : ''}">
                        <div class="goal-card-header">
                            <div class="goal-card-info">
                                <div class="goal-card-icon">${goal.icon}</div>
                                <div>
                                    <div class="goal-card-name">
                                        ${goal.name}
                                        ${isComplete ? '<span style="color: #fbbf24; margin-left: 6px;"></span>' : ''}
                                        ${goal.schedule !== 'none' && !isComplete ? `<span class="auto-save-badge"> ${scheduleLabels[goal.schedule]}</span>` : ''}
                                    </div>
                                    <div class="goal-card-due">
                                        ${dueDateStr ? `<span></span> Due ${dueDateStr}` : 'No deadline set'}
                                    </div>
                                </div>
                            </div>
                            <div class="goal-card-amounts">
                                <div class="goal-card-saved">${formatCurrency(goal.saved)}</div>
                                <div class="goal-card-target">of ${formatCurrency(goal.target)}</div>
                            </div>
                        </div>
                        <div class="goal-card-progress">
                            <div class="goal-progress-info">
                                <span class="goal-progress-remaining">${isComplete ? ' Goal reached!' : formatCurrency(remaining) + ' to go'}</span>
                                <span class="goal-progress-percent">${Math.round(progress)}%</span>
                            </div>
                            <div class="goal-progress-track">
                                <div class="goal-progress-bar" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                        </div>
                        ${nextSaveHtml}
                        <div class="goal-card-footer">
                            <button class="goal-action-btn secondary" onclick="openGoalModal(${goal.id})"> Edit</button>
                            ${!isComplete ? `<button class="goal-action-btn primary" onclick="openDepositModal(${goal.id})"> Add Savings</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateGoalsStats() {
            const totalSaved = goals.reduce((sum, g) => sum + g.saved, 0);
            const totalTarget = goals.reduce((sum, g) => sum + g.target, 0);
            const totalRemaining = Math.max(0, totalTarget - totalSaved);
            const completed = goals.filter(g => g.saved >= g.target).length;
            const overallProgress = totalTarget > 0 ? (totalSaved / totalTarget) * 100 : 0;

            document.getElementById('totalSaved').textContent = formatCurrency(totalSaved);
            document.getElementById('totalTarget').textContent = formatCurrency(totalTarget);
            document.getElementById('goalsCompleted').textContent = completed;
            document.getElementById('goalsProgress').textContent = Math.round(overallProgress) + '%';
            document.getElementById('goalsRemaining').textContent = formatCurrency(totalRemaining);
        }

        function showGoalCelebration(goalName) {
            const overlay = document.getElementById('goalCelebrationOverlay');
            document.getElementById('goalCelebrationText').textContent = `You reached your "${goalName}" goal!`;
            overlay.classList.add('active');
            
            // Create confetti
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.background = ['#fbbf24', '#22c55e', '#3b82f6', '#7c3aed', '#f59e0b'][Math.floor(Math.random() * 5)];
                overlay.appendChild(confetti);
            }

            setTimeout(closeGoalCelebration, 5000);
        }

        function closeGoalCelebration() {
            const overlay = document.getElementById('goalCelebrationOverlay');
            overlay.classList.remove('active');
            overlay.querySelectorAll('.confetti').forEach(c => c.remove());
        }

        function saveGoals() {
            localStorage.setItem('pocketflow_goals', JSON.stringify(goals));
        }

        // =====================
        // EMPIRE (NET WORTH) FUNCTIONS
        // =====================

        function openEmpireModal(mode, itemId = null) {
            empireMode = mode;
            editingEmpireId = itemId;
            
            const modal = document.getElementById('empireModal');
            const title = document.getElementById('empireModalTitle');
            const btn = document.getElementById('empireSubmitBtn');
            const deleteBtn = document.getElementById('empireDeleteBtn');
            const typeGrid = document.getElementById('empireTypeGrid');
            
            const types = mode === 'asset' ? assetTypes : liabilityTypes;
            const colorClass = mode === 'asset' ? 'asset' : 'liability';
            const btnColor = mode === 'asset' ? '#10b981' : '#ef4444';
            
            // Render type grid
            typeGrid.innerHTML = types.map((t, i) => `
                <div class="empire-type-item ${colorClass} ${i === 0 ? 'active' : ''}" data-type="${t.id}" data-icon="${t.icon}">
                    <div class="empire-type-item-icon">${t.icon}</div>
                    <div class="empire-type-item-label">${t.name}</div>
                </div>
            `).join('');

            // Add click handlers
            typeGrid.querySelectorAll('.empire-type-item').forEach(opt => {
                opt.addEventListener('click', (e) => {
                    e.stopPropagation();
                    typeGrid.querySelectorAll('.empire-type-item').forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');
                    selectedEmpireType = opt.dataset.type;
                    selectedEmpireIcon = opt.dataset.icon;
                });
            });

            selectedEmpireType = types[0].id;
            selectedEmpireIcon = types[0].icon;

            if (itemId) {
                const items = mode === 'asset' ? assets : liabilities;
                const item = items.find(i => i.id === itemId);
                if (item) {
                    title.textContent = mode === 'asset' ? 'Edit Asset' : 'Edit Liability';
                    btn.textContent = 'Save Changes';
                    deleteBtn.style.display = 'block';
                    document.getElementById('empireNameInput').value = item.name;
                    document.getElementById('empireValueInput').value = item.value;
                    document.getElementById('empireNotesInput').value = item.notes || '';
                    
                    // Select the right type
                    typeGrid.querySelectorAll('.empire-type-item').forEach(o => {
                        o.classList.toggle('active', o.dataset.type === item.type);
                        if (o.dataset.type === item.type) {
                            selectedEmpireType = item.type;
                            selectedEmpireIcon = item.icon;
                        }
                    });
                }
            } else {
                title.textContent = mode === 'asset' ? 'Add Asset' : 'Add Liability';
                btn.textContent = mode === 'asset' ? 'Add Asset' : 'Add Liability';
                deleteBtn.style.display = 'none';
                document.getElementById('empireNameInput').value = '';
                document.getElementById('empireValueInput').value = '';
                document.getElementById('empireNotesInput').value = '';
            }

            btn.style.background = btnColor;
            modal.classList.add('active');
        }

        function addEmpireItem() {
            const name = document.getElementById('empireNameInput').value.trim();
            const value = parseFloat(document.getElementById('empireValueInput').value);
            const notes = document.getElementById('empireNotesInput').value.trim();

            if (!name) {
                showToast('Please enter a name');
                return;
            }
            if (!value || value < 0) {
                showToast('Please enter a valid value');
                return;
            }

            const item = {
                id: editingEmpireId || Date.now(),
                name,
                value,
                notes,
                type: selectedEmpireType,
                icon: selectedEmpireIcon,
                updatedAt: new Date().toISOString()
            };

            if (empireMode === 'asset') {
                if (editingEmpireId) {
                    const index = assets.findIndex(a => a.id === editingEmpireId);
                    if (index !== -1) assets[index] = item;
                } else {
                    assets.push(item);
                }
                saveAssets();
                showToast(editingEmpireId ? 'Asset updated!' : 'Asset added! ');
            } else {
                if (editingEmpireId) {
                    const index = liabilities.findIndex(l => l.id === editingEmpireId);
                    if (index !== -1) liabilities[index] = item;
                } else {
                    liabilities.push(item);
                }
                saveLiabilities();
                showToast(editingEmpireId ? 'Liability updated!' : 'Liability added!');
            }

            renderEmpireLists();
            updateEmpireStats();
            closeModal('empireModal');
            editingEmpireId = null;
        }

        function deleteCurrentEmpireItem() {
            if (!editingEmpireId) return;
            
            if (confirm('Delete this item?')) {
                if (empireMode === 'asset') {
                    assets = assets.filter(a => a.id !== editingEmpireId);
                    saveAssets();
                } else {
                    liabilities = liabilities.filter(l => l.id !== editingEmpireId);
                    saveLiabilities();
                }
                
                renderEmpireLists();
                updateEmpireStats();
                closeModal('empireModal');
                editingEmpireId = null;
                showToast('Item deleted');
            }
        }

        function renderEmpireLists() {
            // Render Assets
            const assetsContainer = document.getElementById('assetsList');
            if (assets.length === 0) {
                assetsContainer.innerHTML = `
                    <div class="empire-empty">
                        <div class="empire-empty-icon"></div>
                        <p class="empire-empty-text">No assets yet. Add your first!</p>
                    </div>
                `;
            } else {
                const totalAssets = assets.reduce((sum, a) => sum + a.value, 0);
                assetsContainer.innerHTML = assets.map(asset => {
                    const typeInfo = assetTypes.find(t => t.id === asset.type) || assetTypes[assetTypes.length - 1];
                    return `
                        <div class="empire-item" onclick="openEmpireModal('asset', ${asset.id})">
                            <div class="empire-item-icon asset">${asset.icon}</div>
                            <div class="empire-item-info">
                                <div class="empire-item-name">${asset.name}</div>
                                <div class="empire-item-category">${typeInfo.name}</div>
                            </div>
                            <div class="empire-item-value asset">${formatCurrency(asset.value)}</div>
                        </div>
                    `;
                }).join('') + `
                    <div class="empire-section-total">
                        <span class="empire-total-label assets">Total Assets</span>
                        <span class="empire-total-value assets">${formatCurrency(totalAssets)}</span>
                    </div>
                `;
            }

            // Render Liabilities
            const liabilitiesContainer = document.getElementById('liabilitiesList');
            if (liabilities.length === 0) {
                liabilitiesContainer.innerHTML = `
                    <div class="empire-empty">
                        <div class="empire-empty-icon"></div>
                        <p class="empire-empty-text">No liabilities. Great job!</p>
                    </div>
                `;
            } else {
                const totalLiabilities = liabilities.reduce((sum, l) => sum + l.value, 0);
                liabilitiesContainer.innerHTML = liabilities.map(liability => {
                    const typeInfo = liabilityTypes.find(t => t.id === liability.type) || liabilityTypes[liabilityTypes.length - 1];
                    return `
                        <div class="empire-item" onclick="openEmpireModal('liability', ${liability.id})">
                            <div class="empire-item-icon liability">${liability.icon}</div>
                            <div class="empire-item-info">
                                <div class="empire-item-name">${liability.name}</div>
                                <div class="empire-item-category">${typeInfo.name}</div>
                            </div>
                            <div class="empire-item-value liability">${formatCurrency(liability.value)}</div>
                        </div>
                    `;
                }).join('') + `
                    <div class="empire-section-total">
                        <span class="empire-total-label liabilities">Total Liabilities</span>
                        <span class="empire-total-value liabilities">${formatCurrency(totalLiabilities)}</span>
                    </div>
                `;
            }
        }

        function updateEmpireStats() {
            const totalAssets = assets.reduce((sum, a) => sum + a.value, 0);
            const totalLiabilities = liabilities.reduce((sum, l) => sum + l.value, 0);
            const netWorth = totalAssets - totalLiabilities;
            const total = totalAssets + totalLiabilities;
            
            // Net Worth Display
            const netWorthEl = document.getElementById('netWorthValue');
            netWorthEl.textContent = (netWorth < 0 ? '-' : '') + formatCurrency(Math.abs(netWorth));
            netWorthEl.className = 'net-worth-value ' + (netWorth >= 0 ? 'positive' : 'negative');

            // Bar chart
            const assetsPercent = total > 0 ? (totalAssets / total) * 100 : 50;
            const liabilitiesPercent = total > 0 ? (totalLiabilities / total) * 100 : 50;
            document.getElementById('assetsBar').style.width = assetsPercent + '%';
            document.getElementById('liabilitiesBar').style.width = liabilitiesPercent + '%';
            document.getElementById('assetsBarLabel').textContent = formatCurrency(totalAssets) + ' Assets';
            document.getElementById('liabilitiesBarLabel').textContent = formatCurrency(totalLiabilities) + ' Liabilities';

            // Quick stats
            document.getElementById('assetCount').textContent = assets.length;
            document.getElementById('liabilityCount').textContent = liabilities.length;
            
            // Wealth ratio (assets / liabilities)
            const wealthRatio = totalLiabilities > 0 ? Math.round((totalAssets / totalLiabilities) * 100) : (totalAssets > 0 ? '' : 0);
            document.getElementById('wealthRatio').textContent = wealthRatio === '' ? '' : wealthRatio + '%';
        }

        function saveAssets() {
            localStorage.setItem('pocketflow_assets', JSON.stringify(assets));
        }

        function saveLiabilities() {
            localStorage.setItem('pocketflow_liabilities', JSON.stringify(liabilities));
        }

        // =====================
        // RECURRING SUBSCRIPTIONS FUNCTIONS
        // =====================

        function selectSubscriptionType(element, type, icon) {
            document.querySelectorAll('.subscription-type-item').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            selectedSubscriptionType = type;
            selectedSubscriptionIcon = icon;
        }

        function selectBillingCycle(element, cycle) {
            document.querySelectorAll('.billing-cycle-option').forEach(o => o.classList.remove('active'));
            element.classList.add('active');
            selectedBillingCycle = cycle;
        }

        function openSubscriptionModal(subscriptionId = null) {
            editingSubscriptionId = subscriptionId;
            const modal = document.getElementById('subscriptionModal');
            const title = document.getElementById('subscriptionModalTitle');
            const btn = document.getElementById('subscriptionSubmitBtn');
            const deleteBtn = document.getElementById('subscriptionDeleteBtn');
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            
            if (subscriptionId) {
                const sub = subscriptions.find(s => s.id === subscriptionId);
                if (sub) {
                    title.textContent = 'Edit Subscription';
                    btn.textContent = 'Save Changes';
                    deleteBtn.style.display = 'block';
                    document.getElementById('subscriptionNameInput').value = sub.name;
                    document.getElementById('subscriptionAmountInput').value = sub.amount;
                    document.getElementById('subscriptionBillDateInput').value = sub.nextBillDate || today;
                    
                    // Select the right type
                    selectedSubscriptionType = sub.type;
                    selectedSubscriptionIcon = sub.icon;
                    document.querySelectorAll('.subscription-type-item').forEach(o => {
                        o.classList.toggle('active', o.dataset.type === sub.type);
                    });

                    // Select billing cycle
                    selectedBillingCycle = sub.billingCycle || 'monthly';
                    document.querySelectorAll('.billing-cycle-option').forEach(o => {
                        o.classList.toggle('active', o.dataset.cycle === selectedBillingCycle);
                    });
                }
            } else {
                title.textContent = 'Add Subscription';
                btn.textContent = 'Add Subscription';
                deleteBtn.style.display = 'none';
                document.getElementById('subscriptionNameInput').value = '';
                document.getElementById('subscriptionAmountInput').value = '';
                document.getElementById('subscriptionBillDateInput').value = today;
                
                // Reset to defaults
                selectedSubscriptionType = 'streaming';
                selectedSubscriptionIcon = '';
                selectedBillingCycle = 'monthly';
                document.querySelectorAll('.subscription-type-item').forEach(o => {
                    o.classList.toggle('active', o.dataset.type === 'streaming');
                });
                document.querySelectorAll('.billing-cycle-option').forEach(o => {
                    o.classList.toggle('active', o.dataset.cycle === 'monthly');
                });
            }
            
            modal.classList.add('active');
        }

        function addSubscription() {
            const name = document.getElementById('subscriptionNameInput').value.trim();
            const amount = parseFloat(document.getElementById('subscriptionAmountInput').value);
            const nextBillDate = document.getElementById('subscriptionBillDateInput').value;

            if (!name) {
                showToast('Please enter a service name');
                return;
            }
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount');
                return;
            }

            if (editingSubscriptionId) {
                const index = subscriptions.findIndex(s => s.id === editingSubscriptionId);
                if (index !== -1) {
                    subscriptions[index] = {
                        ...subscriptions[index],
                        name,
                        amount,
                        nextBillDate,
                        type: selectedSubscriptionType,
                        icon: selectedSubscriptionIcon,
                        billingCycle: selectedBillingCycle
                    };
                }
                showToast('Subscription updated!');
            } else {
                const subscription = {
                    id: Date.now(),
                    name,
                    amount,
                    nextBillDate,
                    type: selectedSubscriptionType,
                    icon: selectedSubscriptionIcon,
                    billingCycle: selectedBillingCycle,
                    createdAt: new Date().toISOString()
                };
                subscriptions.push(subscription);
                showToast('Subscription added!');
            }

            saveSubscriptions();
            renderSubscriptionsList();
            updateSubscriptionTotals();
            closeModal('subscriptionModal');
            editingSubscriptionId = null;
        }

        function deleteCurrentSubscription() {
            if (editingSubscriptionId && confirm('Delete this subscription?')) {
                subscriptions = subscriptions.filter(s => s.id !== editingSubscriptionId);
                saveSubscriptions();
                renderSubscriptionsList();
                updateSubscriptionTotals();
                closeModal('subscriptionModal');
                editingSubscriptionId = null;
                showToast('Subscription removed');
            }
        }

        function deleteSubscription(id) {
            if (confirm('Delete this subscription?')) {
                subscriptions = subscriptions.filter(s => s.id !== id);
                saveSubscriptions();
                renderSubscriptionsList();
                updateSubscriptionTotals();
                showToast('Subscription removed');
            }
        }

        function renderSubscriptionsList() {
            const container = document.getElementById('recurringList');
            const emptyState = document.getElementById('recurringEmpty');
            const listContainer = document.getElementById('recurringListContainer');
            const statsContainer = document.getElementById('recurringStats');

            if (subscriptions.length === 0) {
                emptyState.style.display = 'block';
                listContainer.style.display = 'none';
                statsContainer.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            listContainer.style.display = 'block';
            statsContainer.style.display = 'grid';

            // Sort by next bill date
            const sorted = [...subscriptions].sort((a, b) => {
                const dateA = new Date(a.nextBillDate || '9999-12-31');
                const dateB = new Date(b.nextBillDate || '9999-12-31');
                return dateA - dateB;
            });

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            container.innerHTML = sorted.map(sub => {
                const monthly = sub.billingCycle === 'yearly' ? sub.amount / 12 : sub.amount;
                const yearly = sub.billingCycle === 'yearly' ? sub.amount : sub.amount * 12;
                
                let nextBillText = '-';
                let isDueSoon = false;
                
                if (sub.nextBillDate) {
                    const billDate = new Date(sub.nextBillDate);
                    const daysUntil = Math.ceil((billDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysUntil <= 0) {
                        nextBillText = 'Due today';
                        isDueSoon = true;
                    } else if (daysUntil <= 3) {
                        nextBillText = `${daysUntil} day${daysUntil > 1 ? 's' : ''}`;
                        isDueSoon = true;
                    } else if (daysUntil <= 7) {
                        nextBillText = `${daysUntil} days`;
                    } else {
                        nextBillText = billDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }
                }
                
                return `
                    <div class="recurring-item ${isDueSoon ? 'due-soon' : ''}">
                        <div class="recurring-item-icon ${sub.type}">${sub.icon}</div>
                        <div class="recurring-item-details">
                            <div class="recurring-item-name">${sub.name}</div>
                            <div class="recurring-item-meta">
                                <span class="recurring-item-cycle">${sub.billingCycle}</span>
                                <span> ${nextBillText}</span>
                                ${isDueSoon ? '<span class="due-badge">DUE SOON</span>' : ''}
                            </div>
                        </div>
                        <div class="recurring-item-amounts">
                            <div class="recurring-item-monthly">${formatCurrency(monthly)}</div>
                            <div class="recurring-item-yearly">${formatCurrency(yearly)}/yr</div>
                        </div>
                        <div class="recurring-item-actions">
                            <button class="recurring-item-action-btn" onclick="openSubscriptionModal(${sub.id})" title="Edit"></button>
                            <button class="recurring-item-action-btn delete" onclick="deleteSubscription(${sub.id})" title="Delete"></button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSubscriptionTotals() {
            let monthlyTotal = 0;
            let yearlyTotal = 0;

            subscriptions.forEach(sub => {
                if (sub.billingCycle === 'yearly') {
                    monthlyTotal += sub.amount / 12;
                    yearlyTotal += sub.amount;
                } else {
                    monthlyTotal += sub.amount;
                    yearlyTotal += sub.amount * 12;
                }
            });

            document.getElementById('recurringMonthlyTotal').textContent = formatCurrency(monthlyTotal);
            document.getElementById('recurringYearlyTotal').textContent = formatCurrency(yearlyTotal);

            // Update stats
            document.getElementById('recurringCount').textContent = subscriptions.length;
            
            const avgMonthly = subscriptions.length > 0 ? monthlyTotal / subscriptions.length : 0;
            document.getElementById('recurringAvg').textContent = formatCurrency(avgMonthly);

            // Find next bill date
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let nextBillDate = null;
            subscriptions.forEach(sub => {
                if (sub.nextBillDate) {
                    const billDate = new Date(sub.nextBillDate);
                    if (billDate >= today && (!nextBillDate || billDate < nextBillDate)) {
                        nextBillDate = billDate;
                    }
                }
            });

            if (nextBillDate) {
                const daysUntil = Math.ceil((nextBillDate - today) / (1000 * 60 * 60 * 24));
                if (daysUntil === 0) {
                    document.getElementById('recurringNext').textContent = 'Today';
                } else if (daysUntil === 1) {
                    document.getElementById('recurringNext').textContent = 'Tomorrow';
                } else {
                    document.getElementById('recurringNext').textContent = nextBillDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                }
            } else {
                document.getElementById('recurringNext').textContent = '-';
            }
        }

        function saveSubscriptions() {
            localStorage.setItem('pocketflow_subscriptions', JSON.stringify(subscriptions));
        }

        // ==================
        // FINANCIAL HEALTH SCORE
        // ==================
        function calculateHealthScore() {
            let score = 0;
            let maxScore = 100;
            let metrics = {};

            // Get monthly data
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const monthlyTransactions = transactions.filter(t => new Date(t.date) >= monthStart);
            
            const monthlyIncome = monthlyTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const monthlyExpenses = monthlyTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const monthlySavings = monthlyIncome - monthlyExpenses;

            // 1. Savings Rate (25 points max)
            let savingsRate = monthlyIncome > 0 ? (monthlySavings / monthlyIncome) * 100 : 0;
            savingsRate = Math.max(0, Math.min(100, savingsRate));
            let savingsScore = 0;
            let savingsStatus = 'bad';
            
            if (savingsRate >= 20) {
                savingsScore = 25;
                savingsStatus = 'good';
            } else if (savingsRate >= 10) {
                savingsScore = 15;
                savingsStatus = 'warning';
            } else if (savingsRate > 0) {
                savingsScore = 8;
                savingsStatus = 'warning';
            }
            score += savingsScore;
            metrics.savingsRate = { value: savingsRate, status: savingsStatus, score: savingsScore };

            // 2. Budget Adherence (20 points max)
            let budgetAdherence = 100;
            let budgetStatus = 'good';
            let budgetScore = 20;
            
            if (budget > 0) {
                const budgetUsed = (monthlyExpenses / budget) * 100;
                budgetAdherence = Math.max(0, 100 - Math.max(0, budgetUsed - 100));
                
                if (budgetUsed <= 80) {
                    budgetScore = 20;
                    budgetStatus = 'good';
                } else if (budgetUsed <= 100) {
                    budgetScore = 15;
                    budgetStatus = 'warning';
                } else if (budgetUsed <= 120) {
                    budgetScore = 8;
                    budgetStatus = 'warning';
                } else {
                    budgetScore = 0;
                    budgetStatus = 'bad';
                }
            } else {
                budgetScore = 10; // Partial credit if no budget set
                budgetStatus = 'warning';
            }
            score += budgetScore;
            metrics.budgetAdherence = { value: budgetAdherence, status: budgetStatus, score: budgetScore };

            // 3. Debt-to-Income Ratio (25 points max)
            const totalDebt = debts.reduce((sum, d) => sum + d.balance, 0);
            const monthlyDebtPayments = debts.reduce((sum, d) => sum + (d.minPayment || 0), 0);
            let debtRatio = monthlyIncome > 0 ? (monthlyDebtPayments / monthlyIncome) * 100 : 0;
            let debtStatus = 'good';
            let debtScore = 25;

            if (debtRatio === 0 && totalDebt === 0) {
                debtScore = 25;
                debtStatus = 'good';
            } else if (debtRatio <= 20) {
                debtScore = 25;
                debtStatus = 'good';
            } else if (debtRatio <= 36) {
                debtScore = 18;
                debtStatus = 'warning';
            } else if (debtRatio <= 50) {
                debtScore = 10;
                debtStatus = 'warning';
            } else {
                debtScore = 0;
                debtStatus = 'bad';
            }
            score += debtScore;
            metrics.debtRatio = { value: debtRatio, status: debtStatus, score: debtScore };

            // 4. Emergency Fund (20 points max)
            const emergencyGoals = goals.filter(g => g.type === 'emergency');
            const totalEmergencySavings = emergencyGoals.reduce((sum, g) => sum + g.saved, 0);
            const avgMonthlyExpenses = monthlyExpenses || budget || 1000;
            const monthsCovered = avgMonthlyExpenses > 0 ? totalEmergencySavings / avgMonthlyExpenses : 0;
            let emergencyStatus = 'bad';
            let emergencyScore = 0;

            if (monthsCovered >= 6) {
                emergencyScore = 20;
                emergencyStatus = 'good';
            } else if (monthsCovered >= 3) {
                emergencyScore = 15;
                emergencyStatus = 'good';
            } else if (monthsCovered >= 1) {
                emergencyScore = 8;
                emergencyStatus = 'warning';
            } else {
                emergencyScore = 0;
                emergencyStatus = 'bad';
            }
            score += emergencyScore;
            metrics.emergencyFund = { value: monthsCovered, status: emergencyStatus, score: emergencyScore };

            // 5. Net Worth (10 points max)
            const totalAssets = assets.reduce((sum, a) => sum + a.value, 0);
            const totalLiabilities = liabilities.reduce((sum, l) => sum + l.value, 0) + totalDebt;
            const netWorth = totalAssets - totalLiabilities;
            let netWorthStatus = 'good';
            let netWorthScore = 10;

            if (netWorth > 0) {
                netWorthScore = 10;
                netWorthStatus = 'good';
            } else if (netWorth === 0) {
                netWorthScore = 5;
                netWorthStatus = 'warning';
            } else {
                netWorthScore = 0;
                netWorthStatus = 'bad';
            }
            score += netWorthScore;
            metrics.netWorth = { value: netWorth, status: netWorthStatus, score: netWorthScore };

            return { score, metrics, monthlyIncome, monthlyExpenses };
        }

        function updateHealthScore() {
            const { score, metrics, monthlyIncome, monthlyExpenses } = calculateHealthScore();
            
            // Update circular progress
            const circle = document.getElementById('healthScoreCircle');
            const circumference = 553; // 2 * PI * 88
            const offset = circumference - (score / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // Set color based on score
            let scoreColor = '#10b981'; // green
            let statusText = 'Excellent!';
            let statusDesc = 'Your finances are in great shape!';
            
            if (score < 40) {
                scoreColor = '#ef4444'; // red
                statusText = 'Needs Work';
                statusDesc = 'Let\'s improve your financial health';
            } else if (score < 60) {
                scoreColor = '#f59e0b'; // yellow
                statusText = 'Fair';
                statusDesc = 'You\'re on the right track';
            } else if (score < 80) {
                scoreColor = '#10b981'; // green
                statusText = 'Good';
                statusDesc = 'Keep up the good habits!';
            }
            
            circle.style.stroke = scoreColor;
            document.getElementById('healthScoreValue').textContent = Math.round(score);
            document.getElementById('healthScoreValue').style.color = scoreColor;
            document.getElementById('healthStatusText').textContent = statusText;
            document.getElementById('healthStatusText').style.color = scoreColor;
            document.getElementById('healthStatusDesc').textContent = statusDesc;

            // Update metrics
            updateHealthMetric('savingsRate', `${metrics.savingsRate.value.toFixed(0)}%`, metrics.savingsRate.status, metrics.savingsRate.value);
            updateHealthMetric('budgetAdherence', `${metrics.budgetAdherence.value.toFixed(0)}%`, metrics.budgetAdherence.status, metrics.budgetAdherence.value);
            updateHealthMetric('debtRatio', `${metrics.debtRatio.value.toFixed(0)}%`, metrics.debtRatio.status, 100 - metrics.debtRatio.value);
            updateHealthMetric('emergencyFund', `${metrics.emergencyFund.value.toFixed(1)} mo`, metrics.emergencyFund.status, Math.min(100, (metrics.emergencyFund.value / 6) * 100));
            updateHealthMetric('netWorth', formatCurrency(metrics.netWorth.value), metrics.netWorth.status, metrics.netWorth.value > 0 ? 100 : (metrics.netWorth.value === 0 ? 50 : 0));

            // Generate tips
            generateHealthTips(metrics, monthlyIncome);
        }

        function updateHealthMetric(id, value, status, barPercent) {
            document.getElementById(`${id}Value`).textContent = value;
            document.getElementById(`${id}Value`).className = `health-metric-value ${status}`;
            document.getElementById(`${id}Icon`).className = `health-metric-icon ${status}`;
            document.getElementById(`${id}Bar`).style.width = `${Math.max(0, Math.min(100, barPercent))}%`;
            document.getElementById(`${id}Bar`).className = `health-metric-bar-fill ${status}`;
        }

        function generateHealthTips(metrics, monthlyIncome) {
            const tips = [];

            if (metrics.savingsRate.status !== 'good') {
                tips.push({
                    icon: '',
                    text: '<strong>Boost your savings:</strong> Try the 50/30/20 rule - 50% needs, 30% wants, 20% savings.'
                });
            }

            if (metrics.budgetAdherence.status === 'bad') {
                tips.push({
                    icon: '',
                    text: '<strong>Track spending:</strong> Review your transactions weekly to stay on budget.'
                });
            }

            if (metrics.debtRatio.status !== 'good') {
                tips.push({
                    icon: '',
                    text: '<strong>Reduce debt:</strong> Focus on high-interest debt first using the avalanche method.'
                });
            }

            if (metrics.emergencyFund.status !== 'good') {
                tips.push({
                    icon: '',
                    text: '<strong>Build emergency fund:</strong> Start with $1,000, then work toward 3-6 months expenses.'
                });
            }

            if (metrics.netWorth.status !== 'good') {
                tips.push({
                    icon: '',
                    text: '<strong>Grow net worth:</strong> Pay down debt and invest the difference to build wealth.'
                });
            }

            if (tips.length === 0) {
                tips.push({
                    icon: '',
                    text: '<strong>Amazing work!</strong> Keep maintaining your excellent financial habits!'
                });
            }

            const container = document.getElementById('healthTips');
            container.innerHTML = tips.map(tip => `
                <div class="health-tip">
                    <div class="health-tip-icon">${tip.icon}</div>
                    <div class="health-tip-text">${tip.text}</div>
                </div>
            `).join('');
        }

        // Start app
        init();
    </script>
</body>
</html>
